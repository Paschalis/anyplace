function __addAlert(a,b,c){a.anyService.addAlert(b,c)}function _err(a,b){__addAlert(a,"danger",b)}function _ShowAlert(a,b,c,d,e){var f=c.data,g=d;null!=f&&null!=f.message&&(e?g+=": "+f.message:g=f.message),b(a,g)}function ShowError(a,b,c,d){d=d||!1,_ShowAlert(a,_err,b,c,d)}function ShowWarningAutohide(a,b,c,d){d=d||!1,_ShowAlert(a,_warn_autohide,b,c,d)}function HandleGeolocationError(a,b){1===b?_warn_autohide(a,ERR_GEOLOC_DEVICE_SETTINGS):2===b?_warn_autohide(a,ERR_GEOLOC_NET_OR_SATELLITES):3===b?_warn_autohide(a,ERR_GEOLOC_TIMEOUT):_warn_autohide(a,ERR_GEOLOC_UNKNOWN)}function selectAllInputText(a){a.setSelectionRange(0,a.value.length)}function getMapsIconBuildingViewer(a,b){var c=new google.maps.Size(27.5,40);return a.isFirefox&&(c=new google.maps.Size(55,80)),new google.maps.Marker({position:b,icon:{url:IMG_BUILDING_VIEWER,size:c,scaledSize:new google.maps.Size(27.5,40)},draggable:!1})}function getMapsIconBuildingArchitect(a,b){return new google.maps.Marker({position:b,map:a,icon:new google.maps.MarkerImage(IMG_BUILDING_ARCHITECT,null,null,null,new google.maps.Size(54,54)),draggable:!1})}function getMapsIconFingerprint(a,b){var c=new google.maps.Size(25,25);return new google.maps.Marker({position:b.location,map:a,icon:new google.maps.MarkerImage(IMG_FINGERPRINT_RED_SPOT,null,null,null,c)})}function clearFingerprintCoverage(){var a=0;if(void 0!==heatMap[a]&&null!==heatMap[a]){for(var b=heatMap.length;b--;)heatMap[b].rectangle.setMap(null),heatMap[b]=null;heatMap=[],document.getElementById("radioHeatmapRSS-mode").classList.remove("quickaction-selected"),_HEATMAP_FINGERPRINT_COVERAGE=!1,setColorClicked("g",!1),setColorClicked("y",!1),setColorClicked("o",!1),setColorClicked("p",!1),setColorClicked("r",!1),$scope.radioHeatmapRSSMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","NO"),$scope.anyService.radioHeatmapRSSMode=!1,$scope.radioHeatmapRSSHasGreen=!1,$scope.radioHeatmapRSSHasYellow=!1,$scope.radioHeatmapRSSHasOrange=!1,$scope.radioHeatmapRSSHasPurple=!1,$scope.radioHeatmapRSSHasRed=!1,$cookieStore.put("RSSClicked","NO")}}function clearFingerprintHeatmap(){var a=0;if(void 0!==fingerPrintsMap[a]&&null!==fingerPrintsMap[a]){for(var b=fingerPrintsMap.length;b--;)fingerPrintsMap[b].setMap(null),fingerPrintsMap[b]=null;fingerPrintsMap=[],_FINGERPRINTS_IS_ON=!1,document.getElementById("fingerPrints-mode").classList.remove("quickaction-selected")}if(heatmap&&heatmap.getMap()){heatmap.setMap(null),_FINGERPRINTS_IS_ON=!1,document.getElementById("fingerPrints-mode").classList.remove("quickaction-selected"),_HEATMAP_F_IS_ON=!1;for(var b=heatmapFingerprints.length;b--;)heatmapFingerprints[b]=null;heatmapFingerprints=[]}}function isNullOrEmpty(a){return null==a||void 0==a||""==a||"-"==a}function getPrettyVersion(a){var b=a.version;return null!=a.variant&&""!==a.variant&&(b+="-"+a.variant),b}function CanvasOverlay(a,b){for(this.top=0,this.left=0,this.width=a.width,this.height=a.height;window&&(this.width>window.innerWidth||this.height>window.innerHeight);)this.width/=2,this.height/=2;this.image_=a,this.map_=b,this.div_=null,this.canvas=null,this.ctx=null,this.angle=0,this.scale=1,this.latlng=b.getCenter(),this.new_left=0,this.new_top=0,this.setMap(b)}function deg2rad(a){return a*Math.PI/180}function rad2deg(a){return a/Math.PI*180}function getRotationDegrees(a){var b=a.css("-webkit-transform")||a.css("-moz-transform")||a.css("-ms-transform")||a.css("-o-transform")||a.css("transform");if("none"!==b)var c=b.split("(")[1].split(")")[0].split(","),d=c[0],e=c[1],f=(c[2],c[3],Math.sqrt(d*d+e*e),Math.round(Math.atan2(e,d)*(180/Math.PI)));else var f=0;return f}function hexToBase64(a){return btoa(String.fromCharCode.apply(null,a.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")))}function base64_encode(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do{b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h)}while(k<a.length);m=n.join("");var o=a.length%3;return(o?m.slice(0,o-3):m)+"===".slice(o||3)}function USGSOverlay(a,b,c){this.bounds_=a,this.image_=b,this.image64=b,this.map_=c,this.div_=null,this.setMap(c)}var app=angular.module("anyViewer",["ngRoute","ui.bootstrap","ui.select","ngSanitize","ngMaterial","angular-loading-bar"]);app.service("GMapService",function(){function a(a){this.tileSize=a}function b(a){this.tileSize=a}function c(a){this.tileSize=a}function d(a){this.tileSize=a}function e(a){var b="custom-maps-attribution",c=document.getElementById(b);void 0!==c&&null!==c||(c=document.createElement("div"),c.id=b,a.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push(c)),"OSM"===f.gmap.getMapTypeId()&&(c.innerHTML='<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'),"roadmap"===f.gmap.getMapTypeId()&&(c.innerHTML=""),"satellite"===f.gmap.getMapTypeId()&&(c.innerHTML=""),"CartoLight"===f.gmap.getMapTypeId()&&(c.innerHTML='<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Â© <a href="https://carto.com/attribution">CARTO</a>')}this.gmap={},this.directionsDisplay=void 0,this.directionsService=void 0;var f=this,g=document.getElementById("map-canvas");a.prototype.maxZoom=22,a.prototype.name="Tile #s",a.prototype.alt="Tile Coordinate Map Type",a.prototype.getTile=function(a,b,c){var d=c.createElement("div");return d.innerHTML=a,d.style.width=this.tileSize.width+"px",d.style.height=this.tileSize.height+"px",d.style.fontSize="10",d.style.borderStyle="solid",d.style.borderWidth="1px",d.style.borderColor="#AAAAAA",d.style.backgroundColor="#E5E3DF",d},b.prototype.maxZoom=22,b.prototype.name="OSM",b.prototype.alt="Tile OSM Map Type",b.prototype.getTile=function(a,b,c){if(b>19)return null;var d=1<<b,e=a.x%d;e<0&&(e=d+e);var f=c.createElement("img");return f.src="https://tile.openstreetmap.org/"+b+"/"+e+"/"+a.y+".png",f.style.width=this.tileSize.width+"px",f.style.height=this.tileSize.height+"px",f},c.prototype.maxZoom=22,c.prototype.name="Carto Light",c.prototype.alt="Tile Carto Light Map Type",c.prototype.getTile=function(a,b,c){var d="https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png";d=d.replace("{x}",a.x).replace("{y}",a.y).replace("{z}",b);var e=c.createElement("img");return e.src=d,e.style.width=this.tileSize.width+"px",e.style.height=this.tileSize.height+"px",e},d.prototype.maxZoom=22,d.prototype.name="Carto Dark",d.prototype.alt="Tile Carto Dark Map Type",d.prototype.getTile=function(a,b,c){var d="https://cartodb-basemaps-a.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png";d=d.replace("{x}",a.x).replace("{y}",a.y).replace("{z}",b);var e=c.createElement("img");return e.src=d,e.style.width=this.tileSize.width+"px",e.style.height=this.tileSize.height+"px",e};var h=DEFAULT_MAP_TILES;"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("mapTypeId",DEFAULT_MAP_TILES),f.gmap=new google.maps.Map(g,{center:new google.maps.LatLng(57,21),zoomControl:!0,fullscreenControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!0,streetViewControl:!1,overviewMapControl:!0,zoom:3,mapTypeId:h,mapTypeControlOptions:{mapTypeIds:["OSM","CartoLight","roadmap","satellite"],style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.LEFT_CENTER}}),google.maps.event.addListener(f.gmap,"tilesloaded",function(){$(".dismissButton").click()}),f.gmap.addListener("maptypeid_changed",function(){"my_custom_layer1"===f.gmap.getMapTypeId()&&f.gmap.zoom<22?f.gmap.setMapTypeId(localStorage.getItem("previousMapTypeId")):"my_custom_layer1"!==f.gmap.getMapTypeId()&&22===f.gmap.zoom&&localStorage.setItem("previousMapTypeId",f.gmap.getMapTypeId());var a="roadmap"===f.gmap.getMapTypeId()||"satellite"===f.gmap.getMapTypeId();localStorage.setItem("mapTypeId",f.gmap.getMapTypeId()),e(f.gmap),f.gmap.setOptions({streetViewControl:a})}),f.gmap.mapTypes.set("OSM",new b(new google.maps.Size(256,256))),f.gmap.mapTypes.set("CartoLight",new c(new google.maps.Size(256,256))),e(f.gmap);var i=new google.maps.DirectionsService,j=new google.maps.DirectionsRenderer;f.calcRoute=function(a,b,c){if("roadmap"!==f.gmap.getMapTypeId()&&"satellite"!==f.gmap.getMapTypeId())return void console.log("Google API deprecated.");if(!a||!b)return void console.log("Invalid start or end point.");var d={origin:a,destination:b,travelMode:google.maps.TravelMode.DRIVING};i.route(d,function(a,b){if(b==google.maps.DirectionsStatus.OK)if(j.setMap(f.gmap),j.setDirections(a),a&&a.routes&&a.routes.length&&a.routes[0].overview_path&&a.routes[0].overview_path.length){var d=a.routes[0].overview_path.length;c(a.routes[0].overview_path[d-1])}else c(void 0);else c(void 0)})},f.clearRoute=function(){j&&j.setMap(null)},f.isRouteShown=function(){return j&&j.getMap()}}),app.factory("AnyplaceService",["$rootScope","$q",function(a,b){var c={};return c.BuildingsLoaded=!0,c.selectedBuilding=void 0,c.selectedFloor=void 0,c.selectedPoi=void 0,c.selectedGenPoi=void 0,c.selectedSearchPoi=void 0,c.myBuildingSelected=void 0,c.selectedCampus=void 0,c.availableFloors={},c.jsonReq={username:"username",password:"password"},c.alerts=[],c.getBuilding=function(){return this.selectedBuilding},c.getBuildingId=function(){if(this.selectedBuilding)return this.selectedBuilding.buid},c.getBuildingName=function(){return this.selectedBuilding?this.selectedBuilding.name:"N/A"},c.getFloor=function(){return this.selectedFloor},c.getFloorNumber=function(){return this.selectedFloor?String(this.selectedFloor.floor_number):"N/A"},c.setBuilding=function(a){this.selectedBuilding=a},c.setFloor=function(a){this.selectedFloor=a},c.setSelectedFloorByNum=function(a){this.selectedFloor=c.availableFloors[a]},c.addAlert=function(a,d){this.alerts[0]={msg:d,type:a},b(function(a,b){setTimeout(function(){a()},3500)}).then(function(){c.alerts.splice(0,1)},function(){})},c.closeAlert=function(a){this.alerts.splice(a,1)},c.getBuildingViewerUrl=function(){return this.selectedBuilding&&this.selectedBuilding.buid?"https://anyplace.cs.ucy.ac.cy/viewer/?buid="+this.selectedBuilding.buid:"N/A"},c.getViewerUrl=function(){var a="";return this.selectedBuilding&&this.selectedBuilding.buid?(a+="&buid="+this.selectedBuilding.buid,this.selectedFloor&&this.selectedFloor.floor_number?(a+="&floor="+this.selectedFloor.floor_number,this.selectedPoi&&this.selectedPoi.puid?a+="&selected="+this.selectedPoi.puid:a):a):a},c.clearAllData=function(){c.selectedPoi=void 0,c.selectedFloor=void 0,c.selectedBuilding=void 0,c.selectedGenPoi=void 0},c}]),app.factory("Alerter",function(){var a={};return a.AlertCtrl="-",a}),app.factory("formDataObject",function(){return function(a,b){var c=new FormData;return angular.forEach(a,function(a,b){c.append(b,a)}),delete b()["Content-Type"],c}}),app.config(["$locationProvider",function(a){a.html5Mode({enabled:!0,requireBase:!1})}]),app.config(["$routeProvider",function(a){a.when("/#/b/:alias",{templateUrl:"index.html",controller:"ControlBarController",caseInsensitiveMatch:!0}).otherwise({redirectTo:"/",caseInsensitiveMatch:!0})}]),app.config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1}]),app.filter("propsFilter",function(){return function(a,b){var c=[];return angular.isArray(a)?a.forEach(function(a){for(var d=!1,e=Object.keys(b),f=0;f<e.length;f++){var g=e[f],h=b[g].toLowerCase();if(-1!==a[g].toString().toLowerCase().indexOf(h)){d=!0;break}}d&&c.push(a)}):c=a,c}});var cAccessPointsWifi="accessPointsWifi",cSpaces="spaces",cCampuses="campuses",cEdges="edges",cFingerprintsWifi="fingerprintsWifi",cFloorplans="floorplans",cPOIS="pois",cUsers="users",cFingerprintTime="cFingerprintTime",cHeatmapWifi1="heatmapWifi1",cHeatmapWifi2="heatmapWifi2",cHeatmapWifi3="heatmapWifi3",fAccessToken="access_token",fAddress="address",fBuCode="bucode",fBuid="buid",fBuids="buids",fBuidA="buid_a",fBuidB="buid_b",fCoOwners="co_owners",fCoordinates="coordinates",fCoordinatesLat="coordinates_lat",fCoordinatesLon="coordinates_lon",fCampusCuid="cuid",fConCuid="cuid",fDescription="description",fEdgeType="edge_type",fExternal="external",fFloor="floor",fFloorA="floor_a",fFloorB="floor_b",fFloorName="floor_name",fFloorNumber="floor_number",fFuid="fuid",fGeometry="geometry",fGreeklish="greeklish",fHeading="heading",fId="_id",fIsBuildingEntrance="is_building_entrance",fIsDoor="is_door",fIsPublished="is_published",fImage="image",fLatTopRight="top_right_lat",fLatBottomLeft="bottom_left_lat",fLonBottomLeft="bottom_left_lng",fLonTopRight="top_right_lng",fLocation="location",fMac="MAC",fMeasurements="measurements",fName="name",fOwnerId="owner_id",fPoisA="pois_a",fPoisB="pois_b",fPoisType="pois_type",fPuid="puid",fRSS="rss",fSchema="_schema",fStrongestWifi="strongestWifi",fTimestamp="timestamp",fTimestampX="timestampX",fTimestampY="timestampY",fType="type",fURL="url",fWeight="weight",fX="x",fY="y",fZoom="zoom",API={};API.old="../anyplace",API.url="../api",API.VERSION=API.url+"/version",API.Mapping={},API.Navigation={},API.Other={},API.Mapping.APs="/wifi/access_points/floor",API.Mapping.APs_URL=API.url+API.Mapping.APs,API.Mapping.GET_APS_IDS="/wifi/access_points/ids",API.Mapping.GET_APS_IDS_URL=API.url+API.Mapping.GET_APS_IDS,API.Mapping.FINGERPRINTS_DELETE="/auth/radiomap/delete",API.Mapping.FINGERPRINTS_DELETE_URL=API.url+API.Mapping.FINGERPRINTS_DELETE,API.Mapping.FINGERPRINTS_DELETE_TIME="/auth/radiomap/delete/time",API.Mapping.FINGERPRINTS_DELETE_TIME_URL=API.url+API.Mapping.FINGERPRINTS_DELETE_TIME,API.Mapping.FINGERPRINTS_TIME="/radiomap/time",API.Mapping.FINGERPRINTS_TIME_URL=API.url+API.Mapping.FINGERPRINTS_TIME,API.Mapping.RADIO_HEATMAP_RSS_1="/heatmap/floor/average/1",API.Mapping.RADIO_HEATMAP_RSS_URL_1=API.url+API.Mapping.RADIO_HEATMAP_RSS_1,API.Mapping.RADIO_HEATMAP_RSS_2="/heatmap/floor/average/2",API.Mapping.RADIO_HEATMAP_RSS_URL_2=API.url+API.Mapping.RADIO_HEATMAP_RSS_2,API.Mapping.RADIO_HEATMAP_RSS_3="/heatmap/floor/average/3",API.Mapping.RADIO_HEATMAP_RSS_URL_3=API.url+API.Mapping.RADIO_HEATMAP_RSS_3,API.Mapping.RADIO_HEATMAP_RSS_3_TILES="/heatmap/floor/average/3/tiles",API.Mapping.RADIO_HEATMAP_RSS_URL_3_TILES=API.url+API.Mapping.RADIO_HEATMAP_RSS_3_TILES,API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_1="/heatmap/floor/average/timestamp/1",API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_1=API.url+API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_1,API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_2="/heatmap/floor/average/timestamp/2",API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_2=API.url+API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_2,API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_3="/heatmap/floor/average/timestamp/3",API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_3=API.url+API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_3,API.Mapping.RADIO_HEATMAP_BY_TIME_TILES="/heatmap/floor/average/timestamp/tiles",API.Mapping.RADIO_HEATMAP_BY_TIME_TILES_URL=API.url+API.Mapping.RADIO_HEATMAP_BY_TIME_TILES,API.Mapping.RADIOMAP_DELETE="/position/radio/heatmap_building_floor_delete",API.Mapping.RADIOMAP_DELETE_URL=API.old+API.Mapping.RADIOMAP_DELETE,API.Mapping.RADIO_HEATMAP_POI="/mapping/radio/radio_heatmap_bbox",API.Mapping.RADIO_HEATMAP_URL_POI=API.old+API.Mapping.RADIO_HEATMAP_POI,API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL="/radiomap/floor/all",API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_URL=API.url+API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL,API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT="/position/radio_by_building_floor_all_text",API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT_URL=API.old+API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT,API.Mapping.BUILDING_ADD="/auth/mapping/space/add",API.Mapping.BUILDING_ADD_URL=API.url+API.Mapping.BUILDING_ADD,API.Mapping.BUILDING_ONE="/mapping/space/get",API.Mapping.BUILDING_ONE_URL=API.url+API.Mapping.BUILDING_ONE,API.Mapping.BUILDING_UPDATE="/auth/mapping/space/update",API.Mapping.BUILDING_UPDATE_URL=API.url+API.Mapping.BUILDING_UPDATE,API.Mapping.BUILDING_DELETE="/auth/mapping/space/delete",API.Mapping.BUILDING_DELETE_URL=API.url+API.Mapping.BUILDING_DELETE,API.Mapping.BUILDING_ALL="/mapping/space/public",API.Mapping.BUILDING_ALL_URL=API.url+API.Mapping.BUILDING_ALL,API.Mapping.BUILDING_ALL_OWNER="/auth/mapping/space/accessible",API.Mapping.BUILDING_ALL_OWNER_URL=API.url+API.Mapping.BUILDING_ALL_OWNER,API.Mapping.CAMPUS_ALL="/auth/mapping/campus/user",API.Mapping.CAMPUS_ALL_URL=API.url+API.Mapping.CAMPUS_ALL,API.Mapping.CAMPUS_UPDATE="/auth/mapping/campus/update",API.Mapping.CAMPUS_UPDATE_URL=API.url+API.Mapping.CAMPUS_UPDATE,API.Mapping.CAMPUS_DELETE="/auth/mapping/campus/delete",API.Mapping.CAMPUS_DELETE_URL=API.url+API.Mapping.CAMPUS_DELETE,API.Mapping.BUILDINGSET_ADD="/auth/mapping/campus/add",API.Mapping.BUILDINGSET_ADD_URL=API.url+API.Mapping.BUILDINGSET_ADD,API.Mapping.BUILDINGSET_ALL="/mapping/campus/get",API.Mapping.BUILDINGSET_ALL_URL=API.url+API.Mapping.BUILDINGSET_ALL,API.Mapping.FLOOR_ADD="/auth/mapping/floor/add",API.Mapping.FLOOR_ADD_URL=API.url+API.Mapping.FLOOR_ADD,API.Mapping.FLOOR_UPDATE="/auth/mapping/floor/update",API.Mapping.FLOOR_UPDATE_URL=API.url+API.Mapping.FLOOR_UPDATE,API.Mapping.FLOOR_DELETE="/auth/mapping/floor/delete",API.Mapping.FLOOR_DELETE_URL=API.url+API.Mapping.FLOOR_DELETE,API.Mapping.FLOOR_ALL="/mapping/floor/all",API.Mapping.FLOOR_ALL_URL=API.url+API.Mapping.FLOOR_ALL,API.Mapping.FLOOR_PLAN_UPLOAD="/mapping/floor/floorplan/upload",API.Mapping.FLOOR_PLAN_UPLOAD_URL=API.url+API.Mapping.FLOOR_PLAN_UPLOAD,API.Mapping.FLOOR_PLAN_DOWNLOAD="/floorplans64/",API.Mapping.FLOOR_PLAN_DOWNLOAD_URL=API.url+API.Mapping.FLOOR_PLAN_DOWNLOAD,API.Mapping.FLOOR_PLAN_DOWNLOAD_ALL="/floorplans64/all/",API.Mapping.FLOOR_PLAN_DOWNLOAD_URL_ALL=API.url+API.Mapping.FLOOR_PLAN_DOWNLOAD_ALL,API.Mapping.POIS_ADD="/auth/mapping/pois/add",API.Mapping.POIS_ADD_URL=API.url+API.Mapping.POIS_ADD,API.Mapping.POIS_UPDATE="/auth/mapping/pois/update",API.Mapping.POIS_UPDATE_URL=API.url+API.Mapping.POIS_UPDATE,API.Mapping.POIS_DELETE="/auth/mapping/pois/delete",API.Mapping.POIS_DELETE_URL=API.url+API.Mapping.POIS_DELETE,API.Mapping.POIS_ALL_FLOOR="/mapping/pois/floor/all",API.Mapping.POIS_ALL_FLOOR_URL=API.url+API.Mapping.POIS_ALL_FLOOR,API.Mapping.POIS_ALL_BUILDING="/mapping/pois/space/all",API.Mapping.POIS_ALL_BUILDING_URL=API.url+API.Mapping.POIS_ALL_BUILDING,API.Mapping.ALL_POIS="/mapping/pois/search",API.Mapping.ALL_POIS_URL=API.url+API.Mapping.ALL_POIS,API.Mapping.CONNECTION_ADD="/auth/mapping/connection/add",API.Mapping.CONNECTION_ADD_URL=API.url+API.Mapping.CONNECTION_ADD,API.Mapping.CONNECTION_UPDATE="/auth/mapping/connection/update",API.Mapping.CONNECTION_UPDATE_URL=API.old+API.Mapping.CONNECTION_UPDATE,API.Mapping.CONNECTION_DELETE="/mapping/connection/delete",API.Mapping.CONNECTION_DELETE_URL=API.url+API.Mapping.CONNECTION_DELETE,API.Mapping.CONNECTION_ALL_FLOOR="/mapping/connection/floor/all",API.Mapping.CONNECTION_ALL_FLOOR_URL=API.url+API.Mapping.CONNECTION_ALL_FLOOR,API.Mapping.LOGIN_GOOGLE="/user/login/google",API.Mapping.LOGIN_GOOGLE_URL=API.url+API.Mapping.LOGIN_GOOGLE,API.Mapping.LOGIN_LOCAL="/user/login",API.Mapping.LOGIN_LOCAL_URL=API.url+API.Mapping.LOGIN_LOCAL,API.Mapping.LOGIN_REFRESH_LOCAL="/user/refresh",API.Mapping.LOGIN_REFRESH_LOCAL_URL=API.url+API.Mapping.LOGIN_REFRESH_LOCAL,API.Mapping.REGISTER_LOCAL="/user/register",API.Mapping.REGISTER_LOCAL_URL=API.url+"/user/register",API.Navigation.POIS_ROUTE="/navigation/route",API.Navigation.POIS_ROUTE=API.url+API.Navigation.POIS_ROUTE,API.Other.GOOGLE_URL_SHORTNER_URL="https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyDLSYNnIC93KfPnMYRL-7xI7yXjOhgulk8",void 0==app&&LOG.F("api.js must be loaded after app.js in GruntFile)"),app.factory("AnyplaceAPIService",["$http","$q","formDataObject",function(a,b,c){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"];var d={};return d.version=function(b){return a({method:"GET",url:API.VERSION,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSS_1=function(b){return LOG.D2("getRadioHeatmapRSS_1"),a({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_URL_1,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSS_2=function(b){return LOG.D2("getRadioHeatmapRSS_2"),a({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_URL_2,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSS_3=function(b){return LOG.D2("getRadioHeatmapRSS_3"),a({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_URL_3,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSS_3_Tiles=function(b){return LOG.D2("getRadioHeatmapRSS_3_Tiles"),a({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_URL_3_TILES,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSSByTime_1=function(b){return LOG.D2("getRadioHeatmapRSSByTime_1"),a({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_1,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSSByTime_2=function(b){return LOG.D2("getRadioHeatmapRSSByTime_2"),a({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_2,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSSByTime_3=function(b){return LOG.D2("getRadioHeatmapRSSByTime_3"),a({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_3,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSSByTime_Tiles=function(b){return LOG.D2("getRadioHeatmapRSSByTime_Tiles"),a({method:"POST",url:API.Mapping.RADIO_HEATMAP_BY_TIME_TILES_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getAPs=function(b){return a({method:"POST",url:API.Mapping.APs_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getAPsIds=function(b){return a({method:"POST",url:API.Mapping.GET_APS_IDS_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteFingerprints=function(b){return a({method:"POST",url:API.Mapping.FINGERPRINTS_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteFingerprintsByTime=function(b){return a({method:"POST",url:API.Mapping.FINGERPRINTS_DELETE_TIME_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getFingerprintsTime=function(b){return a({method:"POST",url:API.Mapping.FINGERPRINTS_TIME_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getHeatmapAcces=function(a){return null},d.retrievePoisByBuilding=function(b){return a({method:"POST",url:API.Mapping.POIS_ALL_BUILDING_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapPoi=function(b){return a({method:"POST",url:API.Mapping.RADIO_HEATMAP_URL_POI,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioByBuildingFloorAll=function(b){return a({method:"POST",url:API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioByBuildingFloorTxt=function(b){return a({method:"POST",url:API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.addBuilding=function(b){return a({method:"POST",url:API.Mapping.BUILDING_ADD_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.addBuildingSet=function(b){return a({method:"POST",url:API.Mapping.BUILDINGSET_ADD_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.updateBuilding=function(b){return a({method:"POST",url:API.Mapping.BUILDING_UPDATE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.updateCampus=function(b){return a({method:"POST",url:API.Mapping.CAMPUS_UPDATE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteBuilding=function(b){return a({method:"POST",url:API.Mapping.BUILDING_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteRadiomaps=function(b){return a({method:"POST",url:API.Mapping.RADIOMAP_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteCampus=function(b){return a({method:"POST",url:API.Mapping.CAMPUS_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.allBuildings=function(b){return a({method:"POST",url:API.Mapping.BUILDING_ALL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.allOwnerBuildings=function(b){return a({method:"POST",url:API.Mapping.BUILDING_ALL_OWNER_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.allCucodeCampus=function(b){return a({method:"POST",url:API.Mapping.BUILDINGSET_ALL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.allCampus=function(b){return a({method:"POST",url:API.Mapping.CAMPUS_ALL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.addFloor=function(b){return a({method:"POST",url:API.Mapping.FLOOR_ADD_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteFloor=function(b){return a({method:"POST",url:API.Mapping.FLOOR_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.allBuildingFloors=function(b){return a({method:"POST",url:API.Mapping.FLOOR_ALL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.uploadFloorPlan=function(b,d){return a({method:"POST",url:API.Mapping.FLOOR_PLAN_UPLOAD_URL,headers:{"Content-Type":"multipart/form-data"},data:{floorplan:d,json:b},transformRequest:c}).success(function(a,b){return a}).error(function(a,b){return a})},d.uploadFloorPlan64=function(b,c){var d=c.replace("data:image/png;base64,",""),e=LPUtils.Base64Binary.decode(d),f=new Blob([e]);d="";for(var g=0;g<e.length;g++)d+=e[g];var h=new FormData;return h.append("json",b),h.append("floorplan",f),a.post(API.Mapping.FLOOR_PLAN_UPLOAD_URL,h,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(a,b){return a}).error(function(a,b){return a})},d.downloadFloorPlan=function(b,c,d){return a({method:"POST",url:API.Mapping.FLOOR_PLAN_DOWNLOAD_URL+c+"/"+d,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.downloadFloorPlanAll=function(b,c,d){return a({method:"POST",url:API.Mapping.FLOOR_PLAN_DOWNLOAD_URL_ALL+c+"/"+d,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.addPois=function(b){return a({method:"POST",url:API.Mapping.POIS_ADD_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.updatePois=function(b){return a({method:"POST",url:API.Mapping.POIS_UPDATE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deletePois=function(b){return a({method:"POST",url:API.Mapping.POIS_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.retrievePoisByBuildingFloor=function(b){return a({method:"POST",url:API.Mapping.POIS_ALL_FLOOR_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.addConnection=function(b){return a({method:"POST",url:API.Mapping.CONNECTION_ADD_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteConnection=function(b){return a({method:"POST",url:API.Mapping.CONNECTION_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.retrieveConnectionsByBuildingFloor=function(b){return a({method:"POST",url:API.Mapping.CONNECTION_ALL_FLOOR_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.loginGoogle=function(b){return LOG.D4("loginGoogle"),LOG.D4(b),a({method:"POST",url:API.Mapping.LOGIN_GOOGLE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.refreshLocalAccount=function(b){return a({method:"POST",url:API.Mapping.LOGIN_REFRESH_LOCAL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.loginLocalAccount=function(b){return a({method:"POST",url:API.Mapping.LOGIN_LOCAL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.registerLocalAccount=function(b){return LOG.D2("api.js"),a({method:"POST",url:API.Mapping.REGISTER_LOCAL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getOneBuilding=function(b){return a({method:"POST",url:API.Mapping.BUILDING_ONE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.retrieveALLPois=function(b){return a({method:"POST",url:API.Mapping.ALL_POIS_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.retrieveRouteFromPoiToPoi=function(b){return a({method:"POST",url:API.Navigation.POIS_ROUTE,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.googleUrlShortener=function(b){return a({method:"POST",url:API.Other.GOOGLE_URL_SHORTNER_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d}]);var MIN_ZOOM_FOR_HEATMAPS=19,MAX_ZOOM_FOR_HEATMAPS=21,_MAX_ZOOM_LEVEL=22,DEFAULT_MAP_TILES="CartoLight";ERR_FETCH_BUILDINGS="Something went wrong while fetching buildings.",ERR_FETCH_ALL_FLOORS="Something went wrong while fetching all floors.",ERR_USER_AUTH="Could not authorize user. Please refresh.",ERR_FETCH_FINGERPRINTS="Something went wrong while fetching fingerprints.",ERR_GEOLOC_DEVICE_SETTINGS="Please enable location access.",ERR_GEOLOC_NET_OR_SATELLITES="Position unavailable. The network is down or the positioning satellites couldn't be contacted.",ERR_GEOLOC_TIMEOUT="Timeout. The request for retrieving your Geolocation was timed out.",ERR_GEOLOC_UNKNOWN="There was an error while retrieving your Geolocation. Please try again.",ERR_GEOLOC_NOT_SUPPORTED="The Geolocation feature is not supported by this browser.",WARN_NO_FINGERPRINTS="This floor seems not to be FingerPrint mapped. Download the Anyplace app from the Google Play store to map the floor.",WARN_ACCES_REMOVED="ACCES map removed.";var IMG_ACCESS_POINT_ARCHITECT="build/images/wireless-router-icon-bg.png",IMG_BUILDING_ARCHITECT="build/images/building-icon.png",IMG_BUILDING_VIEWER="build/images/building-icon-viewer.png",IMG_FINGERPRINT_RED_SPOT="build/images/red_dot.png";$("document").ready(function(){$("#myModal_Welcome").on("shown.bs.modal",function(){$("#myModal_Welcome").trigger("focus")}),$("[rel=tooltip]").length&&$("[rel=tooltip]").tooltip()});var _suc=function(a,b){__addAlert(a,"success",b)},_warn=function(a,b){__addAlert("warning",b)},_warn_autohide=function(a,b){__addAlert(a,"warning",b),window.setTimeout(function(){$(".alert-warning").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},5e3)},_info=function(a,b){__addAlert(a,"info",b),window.setTimeout(function(){$(".alert-info").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},1e4)},LOG={};LOG.level=2,LOG.DBG1=function(){return 1<=LOG.level},LOG.DBG2=function(){return 2<=LOG.level},LOG.DBG3=function(){return 3<=LOG.level},LOG.DBG4=function(){return 4<=LOG.level},LOG.W=function(a){console.log("WARN: "+a)},LOG.E=function(a){console.log("ERR: "+a)},LOG.D=function(a){console.log(a)},LOG.F=function(a){alert(a),window.stop()},LOG.D1=function(a){LOG.DBG1()&&console.log(a)},LOG.D2=function(a){LOG.DBG2()&&console.log(a)},LOG.D3=function(a){LOG.DBG3()&&console.log(a)},LOG.D4=function(a){LOG.DBG4()&&console.log(a)},CanvasOverlay.prototype=new google.maps.OverlayView,CanvasOverlay.prototype.onAdd=function(){var a=document.createElement("div");a.id="canvas_editor",a.style.border="none",a.style.borderWidth="0px",a.style.position="relative",a.style.top=this.top,a.style.left=this.left;var b;if(null!=(b=this.getProjection())){var c=b.fromLatLngToDivPixel(this.latlng);a.style.top=c.y-this.height/2+"px",a.style.left=c.x-this.width/2+"px"}var d=this;jQuery(a).draggable({stop:function(a,c){
if(null!=b){var e=$(this).position().left,f=$(this).position().top;d.latlng=b.fromDivPixelToLatLng(new google.maps.Point(e,f),!0)}}}),jQuery(a).resizable({aspectRatio:this.image_.width/this.image_.height,ghost:!0,handles:"sw, se, nw, ne",helper:"resizable-helper",stop:function(a,b){d.ctx.clearRect(0,0,d.ctx.canvas.width,d.ctx.canvas.height),d.width=b.size.width,d.height=b.size.height,d.setCanvasSize(),d.ctx.save(),d.ctx.translate(d.ctx.canvas.width/2,d.ctx.canvas.height/2),d.ctx.drawImage(d.image_,-d.width/2,-d.height/2,d.width,d.height),d.ctx.restore()}}),jQuery(a).rotatable({stop:function(a,b){}});var e=document.createElement("canvas");return e.id="canvas",a.appendChild(e),this.div_=a,this.canvas=e,this.ctx=e.getContext("2d"),this.initImage(),this.getPanes().overlayImage.appendChild(this.div_),this},CanvasOverlay.prototype.draw=function(){this.div_;null==this.canvas&&alert("error creating the canvas")},CanvasOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_)},CanvasOverlay.prototype.hide=function(){this.div_&&(this.div_.style.visibility="hidden")},CanvasOverlay.prototype.show=function(){this.div_&&(this.div_.style.visibility="visible")},CanvasOverlay.prototype.toggle=function(){this.div_&&("hidden"==this.div_.style.visibility?this.show():this.hide())},CanvasOverlay.prototype.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(this.map_)},CanvasOverlay.prototype.getCanvas=function(){return this.canvas},CanvasOverlay.prototype.getContext2d=function(){return this.ctx},CanvasOverlay.prototype.setCanvasSize=function(){this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.div_.style.width=this.width+"px",this.div_.style.height=this.height+"px"},CanvasOverlay.prototype.initImage=function(){this.setCanvasSize(),this.ctx.save(),this.ctx.translate(this.ctx.canvas.width/2,this.ctx.canvas.height/2),this.ctx.rotate(this.angle),this.ctx.drawImage(this.image_,-this.width/2,-this.height/2,this.width,this.height),this.ctx.restore()},CanvasOverlay.prototype.drawBoundingCanvas=function(){var a=getRotationDegrees($("#canvas_editor")),b=deg2rad(a);console.log("deg["+a+"] rad["+b+"]"),$("#canvas_editor").css({"-moz-transform":"rotate(0deg)","-webkit-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)","-o-transform":"rotate(0deg)",transform:"rotate(0deg)"});var c=getPositionData($("#canvas_editor")),d=c.left,e=c.top,f=d+this.width/2,g=e+this.height/2,h=f+(d-f)*Math.cos(b)+(e-g)*Math.sin(b),i=g-(d-f)*Math.sin(b)+(e-g)*Math.cos(b),j=f+(d+this.width-f)*Math.cos(b)+(e-g)*Math.sin(b),k=g-(d+this.width-f)*Math.sin(b)+(e-g)*Math.cos(b),l=f+(d-f)*Math.cos(b)+(e+this.height-g)*Math.sin(b),m=g-(d-f)*Math.sin(b)+(e+this.height-g)*Math.cos(b),n=f+(d+this.width-f)*Math.cos(b)+(e+this.height-g)*Math.sin(b),o=g-(d+this.width-f)*Math.sin(b)+(e+this.height-g)*Math.cos(b),p=Math.max(h,j,l,n),q=Math.max(i,k,m,o),r=Math.min(h,j,l,n),s=Math.min(i,k,m,o),t=s,u=r,v=p-r,w=q-s;console.log("w["+v+"] h["+w+"]"),$("#canvas_editor").css({top:t+"px",left:u+"px"}),this.ctx.canvas.width=v,this.ctx.canvas.height=w,this.ctx.save(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.translate(f-u,g-t),this.ctx.rotate(b),this.ctx.drawImage(this.image_,-this.width/2,-this.height/2,this.width,this.height),this.ctx.restore(),this.top=t,this.left=u;var x;null!=(x=this.getProjection())&&(this.bottom_left_coords=x.fromContainerPixelToLatLng(new google.maps.Point(this.left,this.top+w),!0),this.top_right_coords=x.fromContainerPixelToLatLng(new google.maps.Point(this.left+v,this.top),!0))};var getPositionData=function(a){return $.extend({width:a.outerWidth(!1),height:a.outerHeight(!1)},a.offset())},LPUtils={};LPUtils.isNullOrUndefined=function(a){return void 0===a||null===a},LPUtils.isStringEmptyNullUndefined=function(a){return!a||0===a.length},LPUtils.isStringBlankNullUndefined=function(a){return!a||/^\s*$/.test(a)},LPUtils.alert=function(a){document.getElementById("notification_panel").innerHTML='<alert type="error" close="LPUtils.closeAlert()">'+a+"</alert>"},LPUtils.closeAlert=function(){document.getElementById("notification_panel").getEl.innerHTML=""},LPUtils.success=function(a){document.getElementById("notification_panel").innerHTML='<alert type="success">'+a+"</alert>"},LPUtils.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=LPUtils.Base64._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=LPUtils.Base64._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),d<128?(b+=String.fromCharCode(d),c++):d>191&&d<224?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}},LPUtils.Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(a){var b=a.length/4*3,c=new ArrayBuffer(b);return this.decode(a,c),c},decode:function(a,b){var c=this._keyStr.indexOf(a.charAt(a.length-1)),d=this._keyStr.indexOf(a.charAt(a.length-2)),e=a.length/4*3;64==c&&e--,64==d&&e--;var f,g,h,i,j,k,l,m,n=0,o=0;for(f=b?new Uint8Array(b):new Uint8Array(e),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,""),n=0;n<e;n+=3)j=this._keyStr.indexOf(a.charAt(o++)),k=this._keyStr.indexOf(a.charAt(o++)),l=this._keyStr.indexOf(a.charAt(o++)),m=this._keyStr.indexOf(a.charAt(o++)),g=j<<2|k>>4,h=(15&k)<<4|l>>2,i=(3&l)<<6|m,f[n]=g,64!=l&&(f[n+1]=h),64!=m&&(f[n+2]=i);return f}},USGSOverlay.prototype=new google.maps.OverlayView,USGSOverlay.prototype.onAdd=function(){var a=document.createElement("div");a.id="ground_overlay",a.style.borderStyle="none",a.style.borderWidth="0px",a.style.position="absolute";var b=document.createElement("img");b.src=this.image64,b.style.width="100%",b.style.height="100%",b.style.position="absolute",a.appendChild(b),this.div_=a,this.getPanes().overlayLayer.appendChild(a)},USGSOverlay.prototype.draw=function(){var a=this.getProjection(),b=a.fromLatLngToDivPixel(this.bounds_.getSouthWest()),c=a.fromLatLngToDivPixel(this.bounds_.getNorthEast()),d=this.div_;d.style.left=b.x+"px",d.style.top=c.y+"px",d.style.width=c.x-b.x+"px",d.style.height=b.y-c.y+"px"},USGSOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},app.controller("AlertController",["$rootScope","$scope","AnyplaceService",function(a,b,c){b.anyService=c,b.alerts=c.alerts,b.closeable=!0}]),app.controller("AppCtrl",function(a,b,c,d){function e(c,d,e){var f;return function(){var e=a,g=Array.prototype.slice.call(arguments);b.cancel(f),f=b(function(){f=void 0,c.apply(e,g)},d||10)}}function f(a){return e(function(){c(a).toggle().then(function(){d.debug("toggle "+a+" is done")})},200)}function g(a){return function(){c(a).toggle().then(function(){d.debug("toggle "+a+" is done")})}}a.toggleLeft=f("left"),a.toggleRight=g("right"),a.isOpenRight=function(){return c("right").isOpen()},a.close=function(){c("right").close().then(function(){d.debug("close RIGHT is done")})}}),app.controller("BuildingController",["$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService","$timeout","$q","$log",function(a,b,c,d,e,f,g,h){function i(){if(""==document.getElementById("myBuildingSelected").value)return a.myBuildings;if(document.getElementById("myBuildingSelected").value==a.mylastquery)return a.data;a.data=[];for(var b=0,c=0;c<a.myBuildings.length;c++){var d=a.myBuildings[c];d.name.toLowerCase().indexOf(document.getElementById("myBuildingSelected").value.toLowerCase())>-1&&(a.data[b]=d,b++)}return a.mylastquery=document.getElementById("myBuildingSelected").value,a.data}a.gmapService=c,a.anyService=d,a.anyAPI=e,a.creds={username:void 0,password:void 0},a.user={name:void 0,email:void 0,username:void 0,password:void 0,owner_id:void 0,access_token:void 0},a.myBuildings=[],a.myBuildingsHashT={},a.mylastquery="",a.myallPois=[],a.myallPoisHashT={},a.myallEntrances=[],a.fetchVersion=function(){var b={};a.anyAPI.version(b).then(function(a){var b=a.data,c=getPrettyVersion(b);LOG.D3("Anyplace Version: "+c),document.getElementById("anyplace-version").textContent="v"+c},function(a){console.log("Failed to get version: "+a.data)})},a.fetchVersion();var j=new MarkerClusterer(a.gmapService.gmap);this.SearchBuilding=i;var k=function(b){for(var c in a.myBuildingsHashT)a.myBuildingsHashT.hasOwnProperty(c)&&a.myBuildingsHashT[c].marker.setVisible(b)};a.$watch("anyService.selectedBuilding",function(b,c){if(b&&b.coordinates_lat&&b.coordinates_lon){if(!b.buid)return void _err(a,"Some information is missing from the building and it could not be loaded.");c&&c.buid&&a.myBuildingsHashT[c.buid].marker.setVisible(!0),a.myBuildingsHashT[b.buid].marker.setVisible(!1),a.gmapService.gmap.panTo(l(b)),a.gmapService.gmap.setZoom(20);try{"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastBuilding",b.buid)}catch(e){}}else k(!0);if(b&&b.puid)for(var d=0;d<a.myBuildings.length;d++)a.myBuildings[d].buid==b.buid&&(b.name=a.myBuildings[d].name)});var l=function(a){if(a&&a.coordinates_lat&&a.coordinates_lon)return{lat:parseFloat(a.coordinates_lat),lng:parseFloat(a.coordinates_lon)}};a.fetchBuilding=function(b){var d={buid:b};a.anyAPI.getOneBuilding(d).then(function(b){var d=b.data,e=d.space;a.myBuildings.push(e);var f=getMapsIconBuildingViewer(a,l(e));j.addMarker(f);var g='<div class="infowindow-scroll-fix"><h5>Building:</h5><span>'+e.name+'</span><h5>Description:</h5><textarea class="infowindow-text-area"  rows="3" readonly>'+e.description+"</textarea></div>";f.infoContent=g,f.building=e,a.myBuildingsHashT[e.buid]={marker:f,model:e},google.maps.event.addListener(f,"click",function(){infowindow.setContent(this.infoContent),infowindow.open(c.gmap,this),setTimeout(function(){infowindow.setMap(null)},2e3);var b=this;a.$apply(function(){a.anyService.selectedBuilding=b.building})}),a.anyService.selectedBuilding=e},function(b){ShowError(a,b,"No matching building found",!0)})},a.fetchAllBuildings=function(){var b={"access-control-allow-origin":"","content-encoding":"gzip","access-control-allow-credentials":"true","content-length":"17516","content-type":"application/json",cuid:a.urlCampus};a.anyAPI.allCucodeCampus(b).then(function(b){var d=b.data;a.myBuildings=d.spaces,a.anyService.selectedCampus=d.name;var e=new google.maps.InfoWindow({content:"-",maxWidth:500}),f=-1,g=void 0;try{"undefined"!=typeof Storage&&localStorage&&localStorage.getItem("lastBuilding")&&(g=localStorage.getItem("lastBuilding"))}catch(o){}for(var h=-1,i=0;i<a.myBuildings.length;i++){var k=a.myBuildings[i];0==i&&(a.gmapService.gmap.panTo(l(k)),a.gmapService.gmap.setZoom(13)),g&&g===k.buid&&(f=i),"true"===k.is_published||1==k.is_published?k.is_published=!0:k.is_published=!1,a.urlBuid&&a.urlBuid==k.buid&&(h=i);var m=getMapsIconBuildingViewer(a,l(k));j.addMarker(m);var n='<div class="infowindow-scroll-fix"><h5 style="margin: 0">Building:</h5><span>'+k.name+'</span><h5 style="margin: 8px 0 0 0">Description:</h5><span>'+k.description+"</span></div>";m.infoContent=n,m.building=k,a.myBuildingsHashT[k.buid]={marker:m,model:k},google.maps.event.addListener(m,"click",function(){e.setContent(this.infoContent),e.open(c.gmap,this),setTimeout(function(){e.setMap(null)},2e3);var b=this;a.$apply(function(){a.anyService.selectedBuilding=b.building})})}h>-1?a.anyService.selectedBuilding=a.myBuildings[h]:a.urlBuid?a.fetchBuilding(a.urlBuid):f>=0&&(a.anyService.selectedBuilding=a.myBuildings[f]),a.anyService.BuildingsLoaded=!1},function(b){ShowError(a,b,ERR_FETCH_BUILDINGS)})},a.fetchAllBuildings();var m=function(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))};a.orderByName=function(a){return a.name},a.orderByDistCentre=function(b){if(a.anyService.selectedBuilding)return b.name;var c=a.gmapService.gmap.getCenter();return m(parseFloat(b.coordinates_lat),parseFloat(b.coordinates_lon),c.lat(),c.lng())}}]),app.controller("BuildingSearchController",["$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService","$timeout","$q","$log",function(a,b,c,d,e,f,g,h){function i(b){if(""!=b)return b==a.mylastquery?a.myallPois:(a.userPosition||a.showUserLocation(),a.anyService.selectedSearchPoi=b,setTimeout(function(){b==a.anyService.selectedSearchPoi&&a.fetchAllPoi(b,a.urlCampus)},1e3),a.mylastquery=b,a.myallPois)}a.gmapService=c,a.anyService=d,a.anyAPI=e,a.creds={username:void 0,password:void 0},a.user={name:void 0,email:void 0,username:void 0,password:void 0,owner_id:void 0,access_token:void 0},a.myBuildings=[],a.myBuildingsnames={},a.data=[],a.datasz=0,a.myallPoisHashT={},a.myallEntrances=[],a.mylastquery="",a.myallPois=[],a.buid="",this.querySearch=i,a.fetchAllPoi=function(b,c){var d={"access-control-allow-origin":"","content-encoding":"gzip","access-control-allow-credentials":"true","content-length":"17516","content-type":"application/json",buid:a.buid,cuid:a.urlCampus,letters:b,greeklish:a.greeklish};null==d.greeklish&&(d.greeklish="true"),e.retrieveALLPois(d).then(function(b){var c=b.data;a.myallPois=c.pois;for(var d=a.myallPois.length,e=d-1;e>=0;e--)a.myallPois[e].buname=a.myBuildingsnames[a.myallPois[e].buid]},function(c){c.data,""==b&&_err(a,"Something went wrong while fetching POIs")})},a.$watch("anyService.selectedBuilding",function(b,c){b&&b.buid&&(a.mylastquery="")}),a.fetchAllBuildings=function(){var b={"access-control-allow-origin":"","content-encoding":"gzip","access-control-allow-credentials":"true","content-length":"17516","content-type":"application/json",cuid:a.urlCampus};b.username=a.creds.username,b.password=a.creds.password,a.anyAPI.allBuildings(b).then(function(b){var c=b.data;a.myBuildings=c.spaces,a.greeklish=c.greeklish;for(var d=0;d<a.myBuildings.length;d++){var e=a.myBuildings[d];a.myBuildingsnames[e.buid]=e.name}},function(b){ShowError(a,b,ERR_FETCH_BUILDINGS)})},a.fetchAllBuildings();var j=function(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))};a.orderByName=function(a){return a.name},a.orderByDistCentre=function(b){if(a.anyService.selectedBuilding)return b.name;var c=a.gmapService.gmap.getCenter();return j(parseFloat(b.coordinates_lat),parseFloat(b.coordinates_lon),c.lat(),c.lng())}}]),app.controller("ControlBarController",["$scope","$rootScope","$routeParams","$location","$compile","GMapService","AnyplaceService",function(a,b,c,d,e,f,g){a.anyService=g,a.gmapService=f,a.isFirefox=navigator.userAgent.search("Firefox")>-1,a.creds={username:void 0,password:void 0},a.user={name:void 0,email:void 0,username:void 0,password:void 0,owner_id:void 0,access_token:void 0},a.tab=1;var h=d.search();h&&(a.urlBuid=h.buid,a.urlFloor=h.floor,a.urlPuid=h.selected,a.urlCampus=h.cuid,a.greeklish="false"),a.setTab=function(b){a.tab=b},a.isTabSet=function(b){return a.tab===b};var i=$("#my-loc-control");i.replaceWith(e(i.html())(a));var j=void 0;a.userPosition=void 0;var k=-1,l=!1;a.isUserLocVisible=!1,a.getIsUserLocVisible=function(){return a.isUserLocVisible},a.panToUserLocation=function(){a.userPosition&&(f.gmap.panTo(a.userPosition),f.gmap.setZoom(20))},a.isMyLocMarkerShown=function(){return j&&j.getMap()},a.displayMyLocMarker=function(b){if(j&&j.getMap())return void j.setPosition(b);var c=new google.maps.Size(20,20);a.isFirefox&&(c=new google.maps.Size(48,48)),j=new google.maps.Marker({position:b,map:f.gmap,draggable:!1,icon:{url:"build/images/location-radius-centre.png",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,10),size:c,scaledSize:new google.maps.Size(20,20)}})},a.showUserLocation=function(){if(a.getIsUserLocVisible())return a.hideUserLocation(),void(navigator.geolocation&&navigator.geolocation.clearWatch(k));navigator.geolocation?k=navigator.geolocation.watchPosition(function(b){var c={lat:b.coords.latitude,lng:b.coords.longitude};a.userPosition=c,a.displayMyLocMarker(c);var d=new google.maps.InfoWindow({content:"Your current location.",maxWidth:500});google.maps.event.addListener(j,"click",function(){var b=this;a.$apply(function(){d.open(f.gmap,b)})}),a.isUserLocVisible||a.$apply(function(){a.isUserLocVisible=!0}),l||(f.gmap.panTo(c),f.gmap.setZoom(19),l=!0)},function(b){a.$apply(function(){HandleGeolocationError(a,b.code)})}):_err(a,ERR_GEOLOC_NOT_SUPPORTED)},a.hideUserLocation=function(){j&&j.setMap(null),a.isUserLocVisible=!1},a.showAndroidPrompt=function(){try{if("undefined"!=typeof Storage&&localStorage&&localStorage.getItem("androidPromptShown")){var a=$("#android_top_DIV_1");a&&a.remove()}}catch(b){}},a.hideAndroidBar=function(){var a=$("#android_top_DIV_1");a&&a.remove();try{"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("androidPromptShown",!0)}catch(b){}};var m=navigator.userAgent.toLowerCase(),n=m.indexOf("android")>-1&&!m.indexOf("windows")>-1,o=$("#android_top_DIV_1");o&&n&&o.css({display:"block"}),a.centerViewToSelectedItem=function(){var b={};if(a.anyService.selectedPoi){var c=a.anyService.selectedPoi;b={lat:parseFloat(c.coordinates_lat),lng:parseFloat(c.coordinates_lon)}}else{if(!a.anyService.selectedBuilding)return void _err(a,"No building is selected.");var d=a.anyService.selectedBuilding;b={lat:parseFloat(d.coordinates_lat),lng:parseFloat(d.coordinates_lon)}}a.gmapService.gmap.panTo(b),a.gmapService.gmap.setZoom(20)}}]),app.controller("DropDownCtrl",["$scope",function(a){a.items=[],a.status={isopen:!1},a.toggled=function(a){},a.toggleDropdown=function(b){b.preventDefault(),b.stopPropagation(),a.status.isopen=!a.status.isopen}}]),app.controller("FloorController",["$scope","$compile","AnyplaceService","GMapService","AnyplaceAPIService",function(a,b,c,d,e){a.anyService=c,a.anyAPI=e,a.xFloors=[],a.data={floor_plan_coords:{},floor_plan_base64_data:{},floor_plan_groundOverlay:null};a.$watch("anyService.selectedBuilding",function(b,c){b&&b.buid?a.fetchAllFloorsForBuilding(b):a.removeFloorPlanOverlay()}),a.$watch("anyService.selectedFloor",function(b,c){if(void 0!==b&&null!==b){a.fetchFloorPlanOverlay(b),d.gmap.panTo(f(a.anyService.selectedBuilding)),d.gmap.setZoom(20);try{"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastFloor",b.floor_number)}catch(e){}}}),a.removeFloorPlanOverlay=function(){a.data.floor_plan_groundOverlay&&a.data.floor_plan_groundOverlay.setMap(null)};var f=function(a){if(a&&a.coordinates_lat&&a.coordinates_lon)return{lat:parseFloat(a.coordinates_lat),lng:parseFloat(a.coordinates_lon)}};a.orderByFloorNo=function(a){return!a||LPUtils.isNullOrUndefined(a.floor_number)?0:parseInt(a.floor_number)},a.fetchAllFloorsForBuilding=function(b){var d=c.jsonReq;d.buid=b.buid,e.allBuildingFloors(d).then(function(c){a.xFloors=c.data.floors,a.xFloors=a.xFloors.sort(function(a,b){return parseInt(a.floor_number)-parseInt(b.floor_number)}),a.anyService.availableFloors={};for(var d=0;d<a.xFloors.length;d++){var e=a.xFloors[d];a.anyService.availableFloors[e.floor_number]=e}if(a.urlFloor)for(var f=0;f<a.xFloors.length;f++)if(a.urlFloor==a.xFloors[f].floor_number)return void(a.anyService.selectedFloor=a.xFloors[f]);try{if("undefined"!=typeof Storage&&localStorage&&!LPUtils.isNullOrUndefined(localStorage.getItem("lastBuilding"))&&!LPUtils.isNullOrUndefined(localStorage.getItem("lastFloor")))for(var g=0;g<a.xFloors.length;g++)if(String(a.xFloors[g].floor_number)===String(localStorage.getItem("lastFloor")))return void(a.anyService.selectedFloor=a.xFloors[g])}catch(i){}if(b&&b.puid)for(var h=0;h<a.xFloors.length;h++)if(a.xFloors[h].floor_number==b.floor_number)return void(a.anyService.selectedFloor=a.xFloors[h]);for(var h=0;h<a.xFloors.length;h++)if("0"==a.xFloors[h].floor_number)return void(a.anyService.selectedFloor=a.xFloors[h]);a.xFloors[0]&&(a.anyService.selectedFloor=a.xFloors[0])},function(b){ShowError(a,b,"Something went wrong while fetching all floors",!0)})},a.fetchFloorPlanOverlay=function(){var b=a.anyService.selectedFloor.floor_number,c=a.anyService.selectedBuilding.buid;e.downloadFloorPlan(this.anyService.jsonReq,c,b).then(function(e){if(c==a.anyService.selectedBuilding.buid&&b==a.anyService.selectedFloor.floor_number){a.data.floor_plan_file=null,a.data.floor_plan=null,null!=a.data.floor_plan_groundOverlay&&(a.data.floor_plan_groundOverlay.setMap(null),a.data.floor_plan_groundOverlay=null);var f=e.data,g=a.anyService.selectedFloor,h=new google.maps.LatLngBounds(new google.maps.LatLng(g.bottom_left_lat,g.bottom_left_lng),new google.maps.LatLng(g.top_right_lat,g.top_right_lng));a.data.floor_plan_groundOverlay=new USGSOverlay(h,"data:image/png;base64,"+f,d.gmap)}},function(a){})};var g=null;a.isCanvasOverlayActive=!1,a.setFloorPlan=function(){if(g){null!==c.getBuildingId()&&void 0!==c.getBuildingId()||(console.log("building is undefined"),_err(a,"Something went wrong. It seems like there is no building selected"));var b={is_published:"true",buid:String(c.getBuildingId()),floor_name:String(a.newFloorNumber),description:String(a.newFloorNumber),floor_number:String(a.newFloorNumber)};a.myFloors[a.myFloorId]=b,a.myFloorId++,g.drawBoundingCanvas();var e=g.bottom_left_coords,f=g.top_right_coords;a.data.floor_plan_coords.bottom_left_lat=e.lat(),a.data.floor_plan_coords.bottom_left_lng=e.lng(),a.data.floor_plan_coords.top_right_lat=f.lat(),a.data.floor_plan_coords.top_right_lng=f.lng();var h=g.getCanvas().toDataURL("image/png");a.data.floor_plan_base64_data=h;var i=new google.maps.LatLngBounds(new google.maps.LatLng(e.lat(),e.lng()),new google.maps.LatLng(f.lat(),f.lng()));a.data.floor_plan_groundOverlay=new USGSOverlay(i,h,d.gmap),g.setMap(null),$("#input-floor-plan").prop("disabled",!1),a.isCanvasOverlayActive=!1,a.addFloorObject(b,a.anyService.selectedBuilding,a.data)}},a.removeFloorPlan=function(){a.data.floor_plan_file=null,a.data.floor_plan=null,g&&g.setMap(null);var b=$("#input-floor-plan");b.replaceWith(b=b.clone(!0)),b.prop("disabled",!1),a.isCanvasOverlayActive=!1},a.floorUp=function(){for(var b=0;b<a.xFloors.length;b++)if(a.xFloors[b].floor_number==a.anyService.selectedFloor.floor_number)return b+1<a.xFloors.length?void(a.anyService.selectedFloor=a.xFloors[b+1]):void 0;_err(a,"Floor not found.")},a.floorDown=function(){for(var b=0;b<a.xFloors.length;b++)if(a.xFloors[b].floor_number==a.anyService.selectedFloor.floor_number)return b-1>=0?void(a.anyService.selectedFloor=a.xFloors[b-1]):void 0;_err(a,"Floor not found.")};var h=$("#floor-controls");h.replaceWith(b(h.html())(a))}]),app.controller("PoiController",["$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService",function(a,b,c,d,e){function f(b){return""==b?a.myPois:b==a.mylastquery?a.myallPois:(a.anyService.selectedSearchPoi=b,setTimeout(function(){b==a.anyService.selectedSearchPoi&&(window.stop(),a.fetchAllPoi(b,a.anyService.selectedBuilding.buid))},200),void(a.mylastquery=b))}var g=new google.maps.Size(62,93),h=new google.maps.Size(21,32),i=new google.maps.Size(31,48),j=17;a.anyService=d,a.anyAPI=e,a.gmapService=c,a.myPois=[],a.myPoisHashT={},a.myEntrances=[],a.showPoiDescription=!1,a.poiShareUrl={puid:void 0,url:"..."},a.poiRouteState={form:void 0},a.togglePoiDescription=function(){a.showPoiDescription=!a.showPoiDescription};var k=void 0,l={},m=void 0,n=void 0,o=!1,p=void 0;a.mylastquery="",a.myallPois=[],this.querySearch=f,a.fetchAllPoi=function(b,c){var d={"access-control-allow-origin":"","content-encoding":"gzip","access-control-allow-credentials":"true","content-length":"17516","content-type":"application/json",buid:c,cuid:"",letters:b,greeklish:a.greeklish};null==d.greeklish&&(d.greeklish="true"),e.retrieveALLPois(d).then(function(b){var c=b.data;a.myallPois=c.pois},function(c){""==b&&ShowError(a,c,"Something went wrong while fetching POIs",!0)})},google.maps.event.addListener(a.gmapService.gmap,"zoom_changed",function(){this.getZoom()<=j?z():A()});var q=function(){if(a.anyService.selectedPoi){var b=a.anyService.selectedPoi;b.puid&&a.myPoisHashT[b.puid]&&a.myPoisHashT[b.puid].marker&&a.myPoisHashT[b.puid].marker.infowindow&&a.myPoisHashT[b.puid].marker.infowindow.setMap(null)}};google.maps.event.addListener(a.gmapService.gmap,"click",function(){q()}),a.$watch("anyService.selectedBuilding",function(b,c){b&&b.buid?(o=!1,a.removePoisOnMap(),a.myEntrances=[],a.myPoisHashT={},a.fetchAllPoisForBuilding(b),a.clearNavPolylines(),b&&b.puid&&r(b)&&(b.floor_number&&a.showPoisOnlyForFloor(b.floor_number),w(b,c),a.showSelectedPoi(b,c))):(a.anyService.selectedPoi=void 0,a.removePoisOnMap(),a.clearNavPolylines())}),a.$watch("anyService.selectedFloor",function(b,c){void 0!==b&&null!==b&&o?(b.floor_number&&a.showPoisOnlyForFloor(b.floor_number),w(b,c)):a.anyService.selectedPoi=void 0}),a.$watch("anyService.selectedPoi",function(b,c){b&&b.puid&&r(b)&&(o||window.stop(),a.showSelectedPoi(b,c))}),a.showSelectedPoi=function(b,d){if(a.poiShareUrl.puid=void 0,a.poiShareUrl.url="...",a.anyService.getFloorNumber()!=b.floor_number&&a.anyService.setSelectedFloorByNum(b.floor_number),c.gmap.panTo(r(b)),c.gmap.setZoom(20),p&&p.puid&&a.myPoisHashT[p.puid]&&a.myPoisHashT[p.puid].marker&&(a.myPoisHashT[p.puid].marker.setIcon(u(p)),c.gmap.getZoom()<=j&&a.myPoisHashT[p.puid].marker.setVisible(!1)),b.puid&&a.myPoisHashT[b.puid]&&a.myPoisHashT[b.puid].marker){var e=a.myPoisHashT[b.puid].marker;e.setVisible(!0),e.setIcon(t(b)),e.infowindow&&(e.infowindow.setContent(e.tpl2),e.infowindow.open(c.gmap,e))}try{"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastPoi",b.puid)}catch(f){}p=b};var r=function(a){if(a&&a.coordinates_lat&&a.coordinates_lon)return{lat:parseFloat(a.coordinates_lat),lng:parseFloat(a.coordinates_lon)}};a.orderByName=function(a){return a.name},a.orderByFloor=function(a){return parseInt(a.floor_number)+a.name};var s=function(a){var b="build/images/any-poi-icon-blue.png";return a.is_building_entrance&&"false"!==a.is_building_entrance?b="build/images/poi_icon_entrance-green.png":"Stair"==a.pois_type?b="build/images/poi_icon_stairs-orange.png":"Elevator"==a.pois_type&&(b="build/images/poi_icon_elevator-purple.png"),b},t=function(b){var c=s(b).replace(/\-[a-z]+\.png/gi,"-red.png"),d=i;return a.isFirefox&&(d=g),{url:c,size:d,scaledSize:i}},u=function(b){var c=h;return a.isFirefox&&(c=g),{url:s(b),size:c,scaledSize:h}},v=function(){for(var a in l)l.hasOwnProperty(a)&&l[a].polyline&&l[a].polyline.setMap(null);l={}},w=function(b,c){if(l){if(b&&b.floor_number){var d=b.floor_number;l[d]&&l[d].polyline&&l[d].polyline.setMap(a.gmapService.gmap)}if(c&&c.floor_number){var e=c.floor_number;l[e]&&l[e].polyline&&l[e].polyline.setMap(null)}}};a.unselectBuilding=function(){a.anyService.selectedBuilding=void 0,a.anyService.selectedFloor=void 0,a.anyService.selectedPoi=void 0;try{"undefined"!=typeof Storage&&localStorage&&localStorage.removeItem("lastBuilding"),localStorage.removeItem("lastFloor"),localStorage.removeItem("lastPoi")}catch(b){}},a.clearNavPolylines=function(){v(),m&&m.setMap(null),c.isRouteShown()&&c.clearRoute(),n&&n.setMap(null),a.getIsUserLocVisible()||a.hideUserLocation()},a.navRoutesShown=function(){for(var a in l)if(l.hasOwnProperty(a)&&l[a].polyline&&l[a].polyline.getMap())return!0;return!(!m||!m.getMap())||!!c.isRouteShown()},a.zoomInPoi=function(){a.gmapService.gmap.panTo(r(a.anyService.selectedPoi)),a.gmapService.gmap.setZoom(20)},a.fetchAllPoisForBuilding=function(b){var c=d.jsonReq;c.buid=b.buid,e.retrievePoisByBuilding(c).then(function(b){var c=b.data;a.myPois=c.pois;for(var d=a.myPois.length,e=d-1;e>=0;e--){var f=a.myPois[e].puid;"true"==a.myPois[e].is_building_entrance?(a.myPois[e].is_building_entrance=!0,a.myEntrances.push(a.myPois[e])):a.myPois[e].is_building_entrance=!1,a.myPoisHashT[f]={},a.myPoisHashT[f].model=a.myPois[e]}o=!0,a.drawPoisOnMapForBuilding(),a.showPoisOnlyForFloor(a.anyService.getFloorNumber())},function(b){ShowError(a,b,"Something went wrong while fetching POIs",!0)})},a.retrieveRouteFromPoiToPoi=function(b,c){if(!b||!b.puid)return void _err(a,"Source POI is corrupted.");if(!c||!c.puid)return void _err(a,"Source POI is corrupted.");var d=a.creds;d.pois_from=b.puid,d.pois_to=c.puid,e.retrieveRouteFromPoiToPoi(d).then(function(c){var d=c.data,e=d.pois;v();for(var f=0;f<e.length;f++)if(e[f].lat&&e[f].lon&&e[f].floor_number){var g=e[f].floor_number;l.hasOwnProperty(g)||(l[g]={flightPlanCoordinates:[]}),l[g].flightPlanCoordinates.push(new google.maps.LatLng(parseFloat(e[f].lat),parseFloat(e[f].lon)))}for(var h in l)l.hasOwnProperty(h)&&(l[h].polyline=new google.maps.Polyline({path:l[h].flightPlanCoordinates,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.75,strokeWeight:6}),a.anyService.selectedFloor.floor_number==h&&l[h].polyline.setMap(a.gmapService.gmap));if(k){var i={path:"M 0,-1 0,1",strokeOpacity:.75,scale:4};n=new google.maps.Polyline({path:[new google.maps.LatLng(parseFloat(b.coordinates_lat),parseFloat(b.coordinates_lon)),new google.maps.LatLng(a.userPosition.lat,a.userPosition.lng)],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:0,strokeWeight:6,icons:[{icon:i,offset:"0",repeat:"20px"}]}),n.setMap(a.gmapService.gmap),k=void 0}},function(b){ShowError(a,b,"Something went wrong while fetching route.",!0)})};var x=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},y=function(b){var c=parseFloat(b.coordinates_lat),d=parseFloat(b.coordinates_lon),e=a.myEntrances;e&&e.length||(e=a.myPois);for(var f=Number.MAX_VALUE,g=void 0,h=0;h<e.length;h++){if(e[h].puid==b.puid)return b;var i,j=parseFloat(e[h].coordinates_lat),k=parseFloat(e[h].coordinates_lon);e&&e.length>0&&(i=x(c,d,j,k)),i<f&&(f=i,g=e[h])}return g};a.getPoiShareUrl=function(b){if(document.getElementById("myText").select(),b===a.poiShareUrl.puid)return void(a.poiShareUrl.puid=void 0);a.poiShareUrl.puid=b,a.anyService.selectedPoi&&a.anyService.selectedPoi.puid==b||(a.anyService.selectedPoi=a.myPoisHashT[b].model);var c="https://anyplace.cs.ucy.ac.cy/viewer/?cuid="+a.urlCampus+a.anyService.getViewerUrl();a.poiShareUrl.embed='<iframe width="100%" height="500" frameborder="0" scrolling="yes" marginheight="0" marginwidth="0" src="'+c+'"></iframe>';var d={longUrl:c};a.anyAPI.googleUrlShortener(d).then(function(b){a.poiShareUrl.url=b.data.id},function(b){a.poiShareUrl.url=c})},a.startNavFromPoi=function(){a.poiRouteState.from=a.anyService.selectedPoi,_suc(a,"Now you can click on another POI to draw the indoor path between the 2 points.")},a.getHtml5GeoLocation=function(b,c){navigator.geolocation?navigator.geolocation.getCurrentPosition(b,c):_err(a,"The Geolocation feature is not supported by this browser.")},a.navigateFromUserToPoiAux=function(b){if(!b)return void _err(a,"Invalid position detected by HTML5.");var c=b.lat,d=b.lng;a.userPosition||(a.userPosition={lat:c,lng:d});var e=new google.maps.LatLng(c,d),f=a.anyService.selectedPoi;if(!f)return void _err(a,"No target poi found.");if(B(c,d)){var g,h=Number.MAX_VALUE,i=void 0,j=a.myPoisHashT;for(var l in j)if(j.hasOwnProperty(l)){var n=j[l].model;if(!n||n.floor_number!=f.floor_number)continue;(g=x(parseFloat(n.coordinates_lat),parseFloat(n.coordinates_lon),c,d))<=h&&(h=g,i=n)}return k=i,a.retrieveRouteFromPoiToPoi(i,f),void(a.getIsUserLocVisible()||a.displayMyLocMarker({lat:c,lng:d}))}k=void 0
;var o=new google.maps.LatLng(parseFloat(f.coordinates_lat),parseFloat(f.coordinates_lon)),p=y(f);p&&(o=new google.maps.LatLng(parseFloat(p.coordinates_lat),parseFloat(p.coordinates_lon))),a.gmapService.calcRoute(e,o,function(b){if(b){var c=a.anyService.selectedPoi;if(p){var d=p,e=[b,new google.maps.LatLng(parseFloat(d.coordinates_lat),parseFloat(d.coordinates_lon))];m&&m.setMap(null);var f={path:"M 0,-1 0,1",strokeOpacity:.75,scale:4};m=new google.maps.Polyline({path:e,geodesic:!0,strokeColor:"#73B9FF",strokeOpacity:0,strokeWeight:6,icons:[{icon:f,offset:"0",repeat:"20px"}]}),m.setMap(a.gmapService.gmap),d.puid!=c.puid&&a.retrieveRouteFromPoiToPoi(d,c)}}})},a.navigateFromUserToPoi=function(b){a.anyService.selectedPoi&&a.anyService.selectedPoi.puid==b||(a.anyService.selectedPoi=a.myPoisHashT[b].model),a.getIsUserLocVisible()&&a.userPosition?a.navigateFromUserToPoiAux(a.userPosition):a.getHtml5GeoLocation(function(b){var c=b.coords.latitude,d=b.coords.longitude;a.navigateFromUserToPoiAux({lat:c,lng:d})},function(b){a.$apply(function(){HandleGeolocationError(a,b.code)})})},a.drawPoisOnMapForBuilding=function(){var d=new google.maps.InfoWindow({content:"-",maxWidth:500}),e=void 0,f=-1;try{"undefined"==typeof Storage||!localStorage||LPUtils.isNullOrUndefined(localStorage.getItem("lastBuilding"))||LPUtils.isNullOrUndefined(localStorage.getItem("lastFloor"))||LPUtils.isNullOrUndefined(localStorage.getItem("lastPoi"))||(e=localStorage.getItem("lastPoi"))}catch(u){}for(var g=!1,i=void 0,j=-1,k=0;k<a.myPois.length;k++){var l=a.myPois[k];e&&l.puid===e&&(f=k),a.urlPuid&&a.urlPuid==l.puid&&(j=k);var m,n="-";if("None"!=l.pois_type){var o=s(l),p=h;a.isFirefox&&(p=new google.maps.Size(62,93));var q=h;m=new google.maps.Marker({position:r(l),map:c.gmap,draggable:!1,icon:{url:o,size:p,scaledSize:q},visible:!1}),n='<div class="iw infowindow-scroll-fix"><div class="wordwrap" style="text-align: center"><span ng-show="navRoutesShown()" id="info-window-zoomin" ng-click="zoomInPoi()"><img src="build/images/html5_location_icon.png"></span><span class="iw-poi-name">'+l.name+'</span></div><div class="wordwrap iw-poi-description" ng-show="showPoiDescription">'+l.description+'</div><div style="text-align: center"><div class="poi-action-btn"><button class="btn btn-info" ng-click="togglePoiDescription()"><i class="fa fa-info-circle"></i></i></button></div><div class="poi-action-btn"><button class="btn btn-primary" ng-click="startNavFromPoi()"><i style="font-size: 12px;" class="fa fa-flag"></i></button></div><div class="poi-action-btn"><button class="btn btn-success" ng-click="navigateFromUserToPoi(\''+l.puid+'\')"><i class="fa fa-location-arrow"></i></button></div><div class="poi-action-btn"><button class="btn btn-warning" ng-click="getPoiShareUrl(\''+l.puid+'\')"><i class="fa fa-share-alt"></i></button></div></div><div ng-show="poiShareUrl.puid" style="margin-top: 2px"><div>Share URL:</div><input class="form-control" id="myText" value="{{poiShareUrl.url}}" onClick="selectAllInputText(this)" readonly/><div>Embed:</div><input class="form-control" value="{{poiShareUrl.embed}}" onClick="selectAllInputText(this)" readonly/></div></div>';var t=b(n)(a);m.tpl2=t[0],m.model=l,m.infowindow=d,a.myPoisHashT[l.puid].marker=m,google.maps.event.addListener(m,"click",function(){var b=this;a.$apply(function(){if(b.model&&b.model.puid){if(a.poiRouteState.from){var d=a.poiRouteState.from;return a.retrieveRouteFromPoiToPoi(d,b.model),d&&d.puid&&a.myPoisHashT[d.puid]&&a.myPoisHashT[d.puid].marker&&(b.infowindow.setContent(a.myPoisHashT[d.puid].marker.tpl2),b.infowindow.open(c.gmap,a.myPoisHashT[d.puid].marker)),void(a.poiRouteState.from=void 0)}a.poiRouteState.from=void 0,a.anyService.selectedPoi&&a.anyService.selectedPoi.puid!=b.model.puid&&a.navRoutesShown()&&a.clearNavPolylines(),a.anyService.selectedGenPoi&&a.anyService.selectedGenPoi.puid!=b.model.puid&&a.navRoutesShown()&&a.clearNavPolylines(),a.anyService.selectedGenPoi&&a.anyService.selectedGenPoi.puid==b.model.puid&&(b.infowindow.setContent(b.tpl2),b.infowindow.open(c.gmap,b)),a.anyService.selectedPoi&&a.anyService.selectedPoi.puid==b.model.puid&&(b.infowindow.setContent(b.tpl2),b.infowindow.open(c.gmap,b)),a.anyService.selectedPoi=b.model}})}),g&&l.is_building_entrance&&(i=l,g=!0)}}j>=0?a.anyService.selectedPoi=a.myPois[j]:f>=0?a.anyService.selectedPoi=a.myPois[f]:g&&i&&(a.anyService.selectedPoi=i)},a.showPoisOnlyForFloor=function(b){for(var c=0;c<a.myPois.length;c++){var d=a.myPois[c];if(d&&a.myPoisHashT[d.puid]&&a.myPoisHashT[d.puid].marker){var e=a.myPoisHashT[d.puid].marker;d.floor_number!=b?(e.setVisible(!1),e.infowindow&&e.infowindow.getMap()&&e.infowindow.setMap(null)):e.setVisible(!0)}}},a.removePoisOnMap=function(){for(var b=0;b<a.myPois.length;b++){var c=a.myPois[b];c&&a.myPoisHashT[c.puid]&&a.myPoisHashT[c.puid].marker&&(a.myPoisHashT[c.puid].marker.setMap(null),delete a.myPoisHashT[c.puid])}};var z=function(){for(var b=0;b<a.myPois.length;b++){var c=a.myPois[b];if((!a.anyService.selectedPoi||c.puid!=a.anyService.selectedPoi.puid)&&(c&&a.myPoisHashT[c.puid]&&a.myPoisHashT[c.puid].marker)){a.myPoisHashT[c.puid].marker.setVisible(!1)}}},A=function(){for(var b=0;b<a.myPois.length;b++){var c=a.myPois[b];if(c.floor_number==a.anyService.getFloorNumber()&&(c&&a.myPoisHashT[c.puid]&&a.myPoisHashT[c.puid].marker)){a.myPoisHashT[c.puid].marker.setVisible(!0)}}},B=function(b,c){var d=a.anyService.selectedFloor;if(!d)return!1;var e=parseFloat(d.bottom_left_lat),f=parseFloat(d.bottom_left_lng),g=parseFloat(d.top_right_lat),h=parseFloat(d.top_right_lng),i=x(e,f,g,h)/2;return x((e+g)/2,(f+h)/2,b,c)<=i}}]);