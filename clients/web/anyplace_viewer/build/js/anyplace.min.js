var app=angular.module("anyViewer",["ngRoute","ui.bootstrap","ui.select","ngSanitize","angular-loading-bar"]);app.service("GMapService",function(){this.gmap={},this.directionsDisplay=void 0,this.directionsService=void 0;var n=this,e=document.getElementById("map-canvas");function t(e){this.tileSize=e}function i(e){this.tileSize=e}t.prototype.maxZoom=22,t.prototype.name="OSM",t.prototype.alt="Tile OSM Map Type",t.prototype.getTile=function(e,t,i){if(19<t)return null;var o=1<<t,n=e.x%o;n<0&&(n=o+n);var r=i.createElement("img");return r.src="https://tile.openstreetmap.org/"+t+"/"+n+"/"+e.y+".png",r.style.width=this.tileSize.width+"px",r.style.height=this.tileSize.height+"px",r},i.prototype.maxZoom=22,i.prototype.name="Carto Light",i.prototype.alt="Tile Carto Light Map Type",i.prototype.getTile=function(e,t,i){var o="https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png";o=o.replace("{x}",e.x).replace("{y}",e.y).replace("{z}",t);var n=i.createElement("img");return n.src=o,n.style.width=this.tileSize.width+"px",n.style.height=this.tileSize.height+"px",n};var o=DEFAULT_MAP_TILES;function r(e){var t="custom-maps-attribution",i=document.getElementById(t);null==i&&((i=document.createElement("div")).id=t,e.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push(i)),"OSM"===n.gmap.getMapTypeId()&&(i.innerHTML='<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'),"roadmap"===n.gmap.getMapTypeId()&&(i.innerHTML=""),"satellite"===n.gmap.getMapTypeId()&&(i.innerHTML=""),"CartoLight"===n.gmap.getMapTypeId()&&(i.innerHTML='<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Â© <a href="https://carto.com/attribution">CARTO</a>')}"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("mapTypeId",DEFAULT_MAP_TILES),n.gmap=new google.maps.Map(e,{center:new google.maps.LatLng(57,21),zoomControl:!0,fullscreenControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!0,streetViewControl:!1,overviewMapControl:!0,zoom:3,mapTypeId:o,mapTypeControlOptions:{mapTypeIds:["OSM","CartoLight","roadmap","satellite"],style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.LEFT_CENTER}}),google.maps.event.addListener(n.gmap,"tilesloaded",function(){$(".dismissButton").click()}),n.gmap.addListener("maptypeid_changed",function(){"my_custom_layer1"===n.gmap.getMapTypeId()&&n.gmap.zoom<22?n.gmap.setMapTypeId(localStorage.getItem("previousMapTypeId")):"my_custom_layer1"!==n.gmap.getMapTypeId()&&22===n.gmap.zoom&&localStorage.setItem("previousMapTypeId",n.gmap.getMapTypeId());var e="roadmap"===n.gmap.getMapTypeId()||"satellite"===n.gmap.getMapTypeId();localStorage.setItem("mapTypeId",n.gmap.getMapTypeId()),r(n.gmap),n.gmap.setOptions({streetViewControl:e})}),n.gmap.mapTypes.set("OSM",new t(new google.maps.Size(256,256))),n.gmap.mapTypes.set("CartoLight",new i(new google.maps.Size(256,256))),r(n.gmap);var a=new google.maps.DirectionsService,l=new google.maps.DirectionsRenderer;n.calcRoute=function(e,t,o){if("roadmap"===n.gmap.getMapTypeId()||"satellite"===n.gmap.getMapTypeId())if(e&&t){var i={origin:e,destination:t,travelMode:google.maps.TravelMode.DRIVING};a.route(i,function(e,t){if(t==google.maps.DirectionsStatus.OK)if(l.setMap(n.gmap),l.setDirections(e),e&&e.routes&&e.routes.length&&e.routes[0].overview_path&&e.routes[0].overview_path.length){var i=e.routes[0].overview_path.length;o(e.routes[0].overview_path[i-1])}else o(void 0);else o(void 0)})}else console.log("Invalid start or end point.");else console.log("Google API deprecated.")},n.clearRoute=function(){l&&l.setMap(null)},n.isRouteShown=function(){return l&&l.getMap()}}),app.factory("AnyplaceService",["$rootScope","$q",function(e,t){var i={BuildingsLoaded:!0,selectedBuilding:void 0,selectedFloor:void 0,selectedPoi:void 0,selectedGenPoi:void 0,selectedSearchPoi:void 0,myBuildingSelected:void 0,selectedCampus:void 0,availableFloors:{},jsonReq:{username:"username",password:"password"},alerts:[],getBuilding:function(){return this.selectedBuilding},getBuildingId:function(){if(this.selectedBuilding)return this.selectedBuilding.buid},getBuildingName:function(){return this.selectedBuilding?this.selectedBuilding.name:"N/A"},getFloor:function(){return this.selectedFloor},getFloorNumber:function(){return this.selectedFloor?String(this.selectedFloor.floor_number):"N/A"},setBuilding:function(e){this.selectedBuilding=e},setFloor:function(e){this.selectedFloor=e},setSelectedFloorByNum:function(e){this.selectedFloor=i.availableFloors[e]},addAlert:function(e,t){this.alerts[0]={msg:t,type:e}},closeAlert:function(e){this.alerts.splice(e,1)},getBuildingViewerUrl:function(){return this.selectedBuilding&&this.selectedBuilding.buid?"https://anyplace.cs.ucy.ac.cy/viewer/?buid="+this.selectedBuilding.buid:"N/A"},getViewerUrl:function(){var e="";return this.selectedBuilding&&this.selectedBuilding.buid?(e+="buid="+this.selectedBuilding.buid,this.selectedFloor&&this.selectedFloor.floor_number?(e+="&floor="+this.selectedFloor.floor_number,this.selectedPoi&&this.selectedPoi.puid?e+="&selected="+this.selectedPoi.puid:e):e):e},clearAllData:function(){i.selectedPoi=void 0,i.selectedFloor=void 0,i.selectedBuilding=void 0,i.selectedGenPoi=void 0}};return i}]),app.factory("Alerter",function(){var e={AlertCtrl:"-"};return e}),app.factory("formDataObject",function(){return function(e,t){var i=new FormData;return angular.forEach(e,function(e,t){i.append(t,e)}),delete t()["Content-Type"],i}}),app.config(["$locationProvider",function(e){e.html5Mode({enabled:!0,requireBase:!1})}]),app.config(["$routeProvider",function(e){e.when("/#/b/:alias",{templateUrl:"index.html",controller:"ControlBarController",caseInsensitiveMatch:!0}).otherwise({redirectTo:"/",caseInsensitiveMatch:!0})}]),app.config(["cfpLoadingBarProvider",function(e){e.includeSpinner=!1}]),app.filter("propsFilter",function(){return function(e,a){var l=[];return angular.isArray(e)?e.forEach(function(e){for(var t=!1,i=Object.keys(a),o=0;o<i.length;o++){var n=i[o],r=a[n].toLowerCase();if(-1!==e[n].toString().toLowerCase().indexOf(r)){t=!0;break}}t&&l.push(e)}):l=e,l}});var API={old:"../anyplace",url:"../api"};API.VERSION=API.url+"/version",API.Mapping={},API.Navigation={},API.Other={},API.Mapping.APs="/wifi/access_points/floor",API.Mapping.APs_URL=API.url+API.Mapping.APs,API.Mapping.GET_APS_IDS="/wifi/access_points/ids",API.Mapping.GET_APS_IDS_URL=API.url+API.Mapping.GET_APS_IDS,API.Mapping.FINGERPRINTS_DELETE="/auth/radiomap/delete",API.Mapping.FINGERPRINTS_DELETE_URL=API.url+API.Mapping.FINGERPRINTS_DELETE,API.Mapping.FINGERPRINTS_DELETE_TIME="/auth/radiomap/delete/time",API.Mapping.FINGERPRINTS_DELETE_TIME_URL=API.url+API.Mapping.FINGERPRINTS_DELETE_TIME,API.Mapping.FINGERPRINTS_TIME="/radiomap/time",API.Mapping.FINGERPRINTS_TIME_URL=API.url+API.Mapping.FINGERPRINTS_TIME,API.Mapping.RADIO_HEATMAP_RSS_1="/heatmap/floor/average/1",API.Mapping.RADIO_HEATMAP_RSS_URL_1=API.url+API.Mapping.RADIO_HEATMAP_RSS_1,API.Mapping.RADIO_HEATMAP_RSS_2="/heatmap/floor/average/2",API.Mapping.RADIO_HEATMAP_RSS_URL_2=API.url+API.Mapping.RADIO_HEATMAP_RSS_2,API.Mapping.RADIO_HEATMAP_RSS_3="/heatmap/floor/average/3",API.Mapping.RADIO_HEATMAP_RSS_URL_3=API.url+API.Mapping.RADIO_HEATMAP_RSS_3,API.Mapping.RADIO_HEATMAP_RSS_3_TILES="/heatmap/floor/average/3/tiles",API.Mapping.RADIO_HEATMAP_RSS_URL_3_TILES=API.url+API.Mapping.RADIO_HEATMAP_RSS_3_TILES,API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_1="/heatmap/floor/average/timestamp/1",API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_1=API.url+API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_1,API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_2="/heatmap/floor/average/timestamp/2",API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_2=API.url+API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_2,API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_3="/heatmap/floor/average/timestamp/3",API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_3=API.url+API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_3,API.Mapping.RADIO_HEATMAP_BY_TIME_TILES="/heatmap/floor/average/timestamp/tiles",API.Mapping.RADIO_HEATMAP_BY_TIME_TILES_URL=API.url+API.Mapping.RADIO_HEATMAP_BY_TIME_TILES,API.Mapping.RADIOMAP_DELETE="/position/radio/heatmap_building_floor_delete",API.Mapping.RADIOMAP_DELETE_URL=API.old+API.Mapping.RADIOMAP_DELETE,API.Mapping.RADIO_HEATMAP_POI="/mapping/radio/radio_heatmap_bbox",API.Mapping.RADIO_HEATMAP_URL_POI=API.old+API.Mapping.RADIO_HEATMAP_POI,API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL="/radiomap/floor/all",API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_URL=API.url+API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL,API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT="/position/radio_by_building_floor_all_text",API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT_URL=API.old+API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT,API.Mapping.BUILDING_ADD="/auth/mapping/space/add",API.Mapping.BUILDING_ADD_URL=API.url+API.Mapping.BUILDING_ADD,API.Mapping.BUILDING_ONE="/mapping/space/get",API.Mapping.BUILDING_ONE_URL=API.url+API.Mapping.BUILDING_ONE,API.Mapping.BUILDING_UPDATE="/auth/mapping/space/update",API.Mapping.BUILDING_UPDATE_URL=API.url+API.Mapping.BUILDING_UPDATE,API.Mapping.BUILDING_DELETE="/auth/mapping/space/delete",API.Mapping.BUILDING_DELETE_URL=API.url+API.Mapping.BUILDING_DELETE,API.Mapping.BUILDING_ALL="/mapping/space/public",API.Mapping.BUILDING_ALL_URL=API.url+API.Mapping.BUILDING_ALL,API.Mapping.BUILDING_ALL_OWNER="/auth/mapping/space/accessible",API.Mapping.BUILDING_ALL_OWNER_URL=API.url+API.Mapping.BUILDING_ALL_OWNER,API.Mapping.CAMPUS_ALL="/auth/mapping/campus/user",API.Mapping.CAMPUS_ALL_URL=API.url+API.Mapping.CAMPUS_ALL,API.Mapping.CAMPUS_UPDATE="/auth/mapping/campus/update",API.Mapping.CAMPUS_UPDATE_URL=API.url+API.Mapping.CAMPUS_UPDATE,API.Mapping.CAMPUS_DELETE="/auth/mapping/campus/delete",API.Mapping.CAMPUS_DELETE_URL=API.url+API.Mapping.CAMPUS_DELETE,API.Mapping.BUILDINGSET_ADD="/auth/mapping/campus/add",API.Mapping.BUILDINGSET_ADD_URL=API.url+API.Mapping.BUILDINGSET_ADD,API.Mapping.BUILDINGSET_ALL="/mapping/campus/get",API.Mapping.BUILDINGSET_ALL_URL=API.url+API.Mapping.BUILDINGSET_ALL,API.Mapping.FLOOR_ADD="/auth/mapping/floor/add",API.Mapping.FLOOR_ADD_URL=API.url+API.Mapping.FLOOR_ADD,API.Mapping.FLOOR_UPDATE="/auth/mapping/floor/update",API.Mapping.FLOOR_UPDATE_URL=API.url+API.Mapping.FLOOR_UPDATE,API.Mapping.FLOOR_DELETE="/auth/mapping/floor/delete",API.Mapping.FLOOR_DELETE_URL=API.url+API.Mapping.FLOOR_DELETE,API.Mapping.FLOOR_ALL="/mapping/floor/all",API.Mapping.FLOOR_ALL_URL=API.url+API.Mapping.FLOOR_ALL,API.Mapping.FLOOR_PLAN_UPLOAD="/mapping/floor/floorplan/upload",API.Mapping.FLOOR_PLAN_UPLOAD_URL=API.url+API.Mapping.FLOOR_PLAN_UPLOAD,API.Mapping.FLOOR_PLAN_DOWNLOAD="/floorplans64/",API.Mapping.FLOOR_PLAN_DOWNLOAD_URL=API.url+API.Mapping.FLOOR_PLAN_DOWNLOAD,API.Mapping.FLOOR_PLAN_DOWNLOAD_ALL="/floorplans64/all/",API.Mapping.FLOOR_PLAN_DOWNLOAD_URL_ALL=API.url+API.Mapping.FLOOR_PLAN_DOWNLOAD_ALL,API.Mapping.POIS_ADD="/auth/mapping/pois/add",API.Mapping.POIS_ADD_URL=API.url+API.Mapping.POIS_ADD,API.Mapping.POIS_UPDATE="/auth/mapping/pois/update",API.Mapping.POIS_UPDATE_URL=API.url+API.Mapping.POIS_UPDATE,API.Mapping.POIS_DELETE="/auth/mapping/pois/delete",API.Mapping.POIS_DELETE_URL=API.url+API.Mapping.POIS_DELETE,API.Mapping.POIS_ALL_FLOOR="/mapping/pois/floor/all",API.Mapping.POIS_ALL_FLOOR_URL=API.url+API.Mapping.POIS_ALL_FLOOR,API.Mapping.POIS_ALL_BUILDING="/mapping/pois/space/all",API.Mapping.POIS_ALL_BUILDING_URL=API.url+API.Mapping.POIS_ALL_BUILDING,API.Mapping.ALL_POIS="/mapping/pois/search",API.Mapping.ALL_POIS_URL=API.url+API.Mapping.ALL_POIS,API.Mapping.CONNECTION_ADD="/auth/mapping/connection/add",API.Mapping.CONNECTION_ADD_URL=API.url+API.Mapping.CONNECTION_ADD,API.Mapping.CONNECTION_UPDATE="/auth/mapping/connection/update",API.Mapping.CONNECTION_UPDATE_URL=API.old+API.Mapping.CONNECTION_UPDATE,API.Mapping.CONNECTION_DELETE="/mapping/connection/delete",API.Mapping.CONNECTION_DELETE_URL=API.url+API.Mapping.CONNECTION_DELETE,API.Mapping.CONNECTION_ALL_FLOOR="/mapping/connection/floor/all",API.Mapping.CONNECTION_ALL_FLOOR_URL=API.url+API.Mapping.CONNECTION_ALL_FLOOR,API.Mapping.LOGIN_GOOGLE="/user/login/google",API.Mapping.LOGIN_GOOGLE_URL=API.url+API.Mapping.LOGIN_GOOGLE,API.Mapping.LOGIN_LOCAL="/user/login",API.Mapping.LOGIN_LOCAL_URL=API.url+API.Mapping.LOGIN_LOCAL,API.Mapping.LOGIN_REFRESH_LOCAL="/user/refresh",API.Mapping.LOGIN_REFRESH_LOCAL_URL=API.url+API.Mapping.LOGIN_REFRESH_LOCAL,API.Mapping.REGISTER_LOCAL="/user/register",API.Mapping.REGISTER_LOCAL_URL=API.url+"/user/register",API.Navigation.POIS_ROUTE="/navigation/route",API.Navigation.POIS_ROUTE=API.url+API.Navigation.POIS_ROUTE,API.Other.GOOGLE_URL_SHORTNER_URL="https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyDLSYNnIC93KfPnMYRL-7xI7yXjOhgulk8",null==app&&LOG.F("api.js must be loaded after app.js in GruntFile)"),app.factory("AnyplaceAPIService",["$http","$q","formDataObject",function(l,e,i){l.defaults.useXDomain=!0,delete l.defaults.headers.common["X-Requested-With"];var t={version:function(e){return l({method:"GET",url:API.VERSION,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getRadioHeatmapRSS_1:function(e){return LOG.D2("getRadioHeatmapRSS_1"),l({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_URL_1,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getRadioHeatmapRSS_2:function(e){return LOG.D2("getRadioHeatmapRSS_2"),l({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_URL_2,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getRadioHeatmapRSS_3:function(e){return LOG.D2("getRadioHeatmapRSS_3"),l({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_URL_3,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getRadioHeatmapRSS_3_Tiles:function(e){return LOG.D2("getRadioHeatmapRSS_3_Tiles"),l({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_URL_3_TILES,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getRadioHeatmapRSSByTime_1:function(e){return LOG.D2("getRadioHeatmapRSSByTime_1"),l({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_1,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getRadioHeatmapRSSByTime_2:function(e){return LOG.D2("getRadioHeatmapRSSByTime_2"),l({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_2,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getRadioHeatmapRSSByTime_3:function(e){return LOG.D2("getRadioHeatmapRSSByTime_3"),l({method:"POST",url:API.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_3,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getRadioHeatmapRSSByTime_Tiles:function(e){return LOG.D2("getRadioHeatmapRSSByTime_Tiles"),l({method:"POST",url:API.Mapping.RADIO_HEATMAP_BY_TIME_TILES_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getAPs:function(e){return l({method:"POST",url:API.Mapping.APs_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getAPsIds:function(e){return l({method:"POST",url:API.Mapping.GET_APS_IDS_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},deleteFingerprints:function(e){return l({method:"POST",url:API.Mapping.FINGERPRINTS_DELETE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},deleteFingerprintsByTime:function(e){return l({method:"POST",url:API.Mapping.FINGERPRINTS_DELETE_TIME_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getFingerprintsTime:function(e){return l({method:"POST",url:API.Mapping.FINGERPRINTS_TIME_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getHeatmapAcces:function(e){return null},retrievePoisByBuilding:function(e){return l({method:"POST",url:API.Mapping.POIS_ALL_BUILDING_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getRadioHeatmapPoi:function(e){return l({method:"POST",url:API.Mapping.RADIO_HEATMAP_URL_POI,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getRadioByBuildingFloorAll:function(e){return l({method:"POST",url:API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getRadioByBuildingFloorTxt:function(e){return l({method:"POST",url:API.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},addBuilding:function(e){return l({method:"POST",url:API.Mapping.BUILDING_ADD_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},addBuildingSet:function(e){return l({method:"POST",url:API.Mapping.BUILDINGSET_ADD_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},updateBuilding:function(e){return l({method:"POST",url:API.Mapping.BUILDING_UPDATE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},updateCampus:function(e){return l({method:"POST",url:API.Mapping.CAMPUS_UPDATE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},deleteBuilding:function(e){return l({method:"POST",url:API.Mapping.BUILDING_DELETE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},deleteRadiomaps:function(e){return l({method:"POST",url:API.Mapping.RADIOMAP_DELETE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},deleteCampus:function(e){return l({method:"POST",url:API.Mapping.CAMPUS_DELETE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},allBuildings:function(e){return l({method:"POST",url:API.Mapping.BUILDING_ALL_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},allOwnerBuildings:function(e){return l({method:"POST",url:API.Mapping.BUILDING_ALL_OWNER_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},allCucodeCampus:function(e){return l({method:"POST",url:API.Mapping.BUILDINGSET_ALL_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},allCampus:function(e){return l({method:"POST",url:API.Mapping.CAMPUS_ALL_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},addFloor:function(e){return l({method:"POST",url:API.Mapping.FLOOR_ADD_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},deleteFloor:function(e){return l({method:"POST",url:API.Mapping.FLOOR_DELETE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},allBuildingFloors:function(e){return l({method:"POST",url:API.Mapping.FLOOR_ALL_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},uploadFloorPlan:function(e,t){return l({method:"POST",url:API.Mapping.FLOOR_PLAN_UPLOAD_URL,headers:{"Content-Type":"multipart/form-data"},data:{floorplan:t,json:e},transformRequest:i}).success(function(e,t){return e}).error(function(e,t){return e})},uploadFloorPlan64:function(e,t){var i=t.replace("data:image/png;base64,",""),o=LPUtils.Base64Binary.decode(i),n=new Blob([o]);i="";for(var r=0;r<o.length;r++)i+=o[r];var a=new FormData;return a.append("json",e),a.append("floorplan",n),l.post(API.Mapping.FLOOR_PLAN_UPLOAD_URL,a,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e,t){return e}).error(function(e,t){return e})},downloadFloorPlan:function(e,t,i){return l({method:"POST",url:API.Mapping.FLOOR_PLAN_DOWNLOAD_URL+t+"/"+i,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},downloadFloorPlanAll:function(e,t,i){return l({method:"POST",url:API.Mapping.FLOOR_PLAN_DOWNLOAD_URL_ALL+t+"/"+i,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},addPois:function(e){return l({method:"POST",url:API.Mapping.POIS_ADD_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},updatePois:function(e){return l({method:"POST",url:API.Mapping.POIS_UPDATE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},deletePois:function(e){return l({method:"POST",url:API.Mapping.POIS_DELETE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},retrievePoisByBuildingFloor:function(e){return l({method:"POST",url:API.Mapping.POIS_ALL_FLOOR_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},addConnection:function(e){return l({method:"POST",url:API.Mapping.CONNECTION_ADD_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},deleteConnection:function(e){return l({method:"POST",url:API.Mapping.CONNECTION_DELETE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},retrieveConnectionsByBuildingFloor:function(e){return l({method:"POST",url:API.Mapping.CONNECTION_ALL_FLOOR_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},loginGoogle:function(e){return LOG.D4("loginGoogle"),LOG.D4(e),l({method:"POST",url:API.Mapping.LOGIN_GOOGLE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},refreshLocalAccount:function(e){return l({method:"POST",url:API.Mapping.LOGIN_REFRESH_LOCAL_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},loginLocalAccount:function(e){return l({method:"POST",url:API.Mapping.LOGIN_LOCAL_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},registerLocalAccount:function(e){return LOG.D2("api.js"),l({method:"POST",url:API.Mapping.REGISTER_LOCAL_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},getOneBuilding:function(e){return l({method:"POST",url:API.Mapping.BUILDING_ONE_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},retrieveALLPois:function(e){return l({method:"POST",url:API.Mapping.ALL_POIS_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},retrieveRouteFromPoiToPoi:function(e){return l({method:"POST",url:API.Navigation.POIS_ROUTE,data:e}).success(function(e,t){return e}).error(function(e,t){return e})},googleUrlShortener:function(e){return l({method:"POST",url:API.Other.GOOGLE_URL_SHORTNER_URL,data:e}).success(function(e,t){return e}).error(function(e,t){return e})}};return t}]);var MIN_ZOOM_FOR_HEATMAPS=19,MAX_ZOOM_FOR_HEATMAPS=21,_MAX_ZOOM_LEVEL=22,DEFAULT_MAP_TILES="CartoLight";ERR_FETCH_BUILDINGS="Something went wrong while fetching buildings.",ERR_FETCH_ALL_FLOORS="Something went wrong while fetching all floors.",ERR_USER_AUTH="Could not authorize user. Please refresh.",ERR_FETCH_FINGERPRINTS="Something went wrong while fetching fingerprints.",ERR_GEOLOC_DEVICE_SETTINGS="Please enable location access.",ERR_GEOLOC_NET_OR_SATELLITES="Position unavailable. The network is down or the positioning satellites couldn't be contacted.",ERR_GEOLOC_TIMEOUT="Timeout. The request for retrieving your Geolocation was timed out.",ERR_GEOLOC_UNKNOWN="There was an error while retrieving your Geolocation. Please try again.",ERR_GEOLOC_NOT_SUPPORTED="The Geolocation feature is not supported by this browser.",WARN_NO_FINGERPRINTS="This floor seems not to be FingerPrint mapped. Download the Anyplace app from the Google Play store to map the floor.",WARN_ACCES_REMOVED="ACCES map removed.";var cAccessPointsWifi="accessPointsWifi",cSpaces="spaces",cCampuses="campuses",cEdges="edges",cFingerprintsWifi="fingerprintsWifi",cFloorplans="floorplans",cPOIS="pois",cUsers="users",cFingerprintTime="cFingerprintTime",cHeatmapWifi1="heatmapWifi1",cHeatmapWifi2="heatmapWifi2",cHeatmapWifi3="heatmapWifi3",fAccessToken="access_token",fAddress="address",fBuCode="bucode",fBuid="buid",fBuids="buids",fBuidA="buid_a",fBuidB="buid_b",fCoOwners="co_owners",fCoordinates="coordinates",fCoordinatesLat="coordinates_lat",fCoordinatesLon="coordinates_lon",fCampusCuid="cuid",fConCuid="cuid",fDescription="description",fEdgeType="edge_type",fExternal="external",fFloor="floor",fFloorA="floor_a",fFloorB="floor_b",fFloorName="floor_name",fFloorNumber="floor_number",fFuid="fuid",fGeometry="geometry",fGreeklish="greeklish",fHeading="heading",fId="_id",fIsBuildingEntrance="is_building_entrance",fIsDoor="is_door",fIsPublished="is_published",fImage="image",fLatTopRight="top_right_lat",fLatBottomLeft="bottom_left_lat",fLonBottomLeft="bottom_left_lng",fLonTopRight="top_right_lng",fLocation="location",fMac="MAC",fMeasurements="measurements",fName="name",fOwnerId="owner_id",fPoisA="pois_a",fPoisB="pois_b",fPoisType="pois_type",fPuid="puid",fRSS="rss",fSchema="_schema",fStrongestWifi="strongestWifi",fTimestamp="timestamp",fTimestampX="timestampX",fTimestampY="timestampY",fType="type",fURL="url",fWeight="weight",fX="x",fY="y",fZoom="zoom",IMG_ACCESS_POINT_ARCHITECT="build/images/wireless-router-icon-bg.png",IMG_BUILDING_ARCHITECT="build/images/building-icon.png",IMG_BUILDING_VIEWER="build/images/building-icon-viewer.png",IMG_FINGERPRINT_RED_SPOT="build/images/red_dot.png";function __addAlert(e,t,i){e.anyService.addAlert(t,i)}function _err(e,t){__addAlert(e,"danger",t)}$("document").ready(function(){$("#myModal_Welcome").on("shown.bs.modal",function(){$("#myModal_Welcome").trigger("focus")}),$("[rel=tooltip]").length&&$("[rel=tooltip]").tooltip()});var _suc=function(e,t){__addAlert(e,"success",t)},_warn=function(e,t){__addAlert("warning",t)},_warn_autohide=function(e,t){__addAlert(e,"warning",t),window.setTimeout(function(){$(".alert-warning").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},5e3)},_info=function(e,t){__addAlert(e,"info",t),window.setTimeout(function(){$(".alert-info").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},1e4)};function _ShowAlert(e,t,i,o,n){var r=i.data,a=o;null!=r&&null!=r.message&&(n?a+=": "+r.message:a=r.message),t(e,a)}function ShowError(e,t,i,o){_ShowAlert(e,_err,t,i,o=o||!1)}function ShowWarningAutohide(e,t,i,o){_ShowAlert(e,_warn_autohide,t,i,o=o||!1)}function HandleGeolocationError(e,t){_warn_autohide(e,1===t?ERR_GEOLOC_DEVICE_SETTINGS:2===t?ERR_GEOLOC_NET_OR_SATELLITES:3===t?ERR_GEOLOC_TIMEOUT:ERR_GEOLOC_UNKNOWN)}function selectAllInputText(e){e.setSelectionRange(0,e.value.length)}function getMapsIconBuildingViewer(e,t){var i=new google.maps.Size(27.5,40);return e.isFirefox&&(i=new google.maps.Size(55,80)),new google.maps.Marker({position:t,icon:{url:IMG_BUILDING_VIEWER,size:i,scaledSize:new google.maps.Size(27.5,40)},draggable:!1})}function getMapsIconBuildingArchitect(e,t){return new google.maps.Marker({position:t,map:e,icon:new google.maps.MarkerImage(IMG_BUILDING_ARCHITECT,null,null,null,new google.maps.Size(54,54)),draggable:!1})}function getMapsIconFingerprint(e,t){var i=new google.maps.Size(25,25);return new google.maps.Marker({position:t.location,map:e,icon:new google.maps.MarkerImage(IMG_FINGERPRINT_RED_SPOT,null,null,null,i)})}function clearFingerprintCoverage(){if(void 0!==heatMap[0]&&null!==heatMap[0]){for(var e=heatMap.length;e--;)heatMap[e].rectangle.setMap(null),heatMap[e]=null;heatMap=[],document.getElementById("radioHeatmapRSS-mode").classList.remove("quickaction-selected"),_HEATMAP_FINGERPRINT_COVERAGE=!1,setColorClicked("g",!1),setColorClicked("y",!1),setColorClicked("o",!1),setColorClicked("p",!1),setColorClicked("r",!1),$scope.radioHeatmapRSSMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","NO"),$scope.anyService.radioHeatmapRSSMode=!1,$scope.radioHeatmapRSSHasGreen=!1,$scope.radioHeatmapRSSHasYellow=!1,$scope.radioHeatmapRSSHasOrange=!1,$scope.radioHeatmapRSSHasPurple=!1,$scope.radioHeatmapRSSHasRed=!1,$cookieStore.put("RSSClicked","NO")}}function clearFingerprintHeatmap(){if(void 0!==fingerPrintsMap[0]&&null!==fingerPrintsMap[0]){for(var e=fingerPrintsMap.length;e--;)fingerPrintsMap[e].setMap(null),fingerPrintsMap[e]=null;fingerPrintsMap=[],_FINGERPRINTS_IS_ON=!1,document.getElementById("fingerPrints-mode").classList.remove("quickaction-selected")}if(heatmap&&heatmap.getMap()){heatmap.setMap(null),_FINGERPRINTS_IS_ON=!1,document.getElementById("fingerPrints-mode").classList.remove("quickaction-selected"),_HEATMAP_F_IS_ON=!1;for(e=heatmapFingerprints.length;e--;)heatmapFingerprints[e]=null;heatmapFingerprints=[]}}function isNullOrEmpty(e){return null==e||null==e||""==e||"-"==e}function getPrettyVersion(e){var t=e.version;return null!=e.variant&&""!==e.variant&&(t+="-"+e.variant),t}var LOG={};function CanvasOverlay(e,t){for(this.top=0,this.left=0,this.width=e.width,this.height=e.height;window&&(this.width>window.innerWidth||this.height>window.innerHeight);)this.width/=2,this.height/=2;this.image_=e,this.map_=t,this.div_=null,this.canvas=null,this.ctx=null,this.angle=0,this.scale=1,this.latlng=t.getCenter(),this.new_left=0,this.new_top=0,this.setMap(t)}function deg2rad(e){return e*Math.PI/180}function rad2deg(e){return e/Math.PI*180}function getRotationDegrees(e){var t=e.css("-webkit-transform")||e.css("-moz-transform")||e.css("-ms-transform")||e.css("-o-transform")||e.css("transform");if("none"!==t)var i=t.split("(")[1].split(")")[0].split(","),o=i[0],n=i[1],r=(i[2],i[3],Math.sqrt(o*o+n*n),Math.round(Math.atan2(n,o)*(180/Math.PI)));else r=0;return r}LOG.level=2,LOG.DBG1=function(){return 1<=LOG.level},LOG.DBG2=function(){return 2<=LOG.level},LOG.DBG3=function(){return 3<=LOG.level},LOG.DBG4=function(){return 4<=LOG.level},LOG.W=function(e){console.log("WARN: "+e)},LOG.E=function(e){console.log("ERR: "+e)},LOG.D=function(e){console.log(e)},LOG.F=function(e){alert(e),window.stop()},LOG.D1=function(e){LOG.DBG1()&&console.log(e)},LOG.D2=function(e){LOG.DBG2()&&console.log(e)},LOG.D3=function(e){LOG.DBG3()&&console.log(e)},LOG.D4=function(e){LOG.DBG4()&&console.log(e)},CanvasOverlay.prototype=new google.maps.OverlayView,CanvasOverlay.prototype.onAdd=function(){var n,e=document.createElement("div");if(e.id="canvas_editor",e.style.border="none",e.style.borderWidth="0px",e.style.position="relative",e.style.top=this.top,e.style.left=this.left,null!=(n=this.getProjection())){var t=n.fromLatLngToDivPixel(this.latlng);e.style.top=t.y-this.height/2+"px",e.style.left=t.x-this.width/2+"px"}var r=this;jQuery(e).draggable({stop:function(e,t){if(null!=n){var i=$(this).position().left,o=$(this).position().top;r.latlng=n.fromDivPixelToLatLng(new google.maps.Point(i,o),!0)}}}),jQuery(e).resizable({aspectRatio:this.image_.width/this.image_.height,ghost:!0,handles:"sw, se, nw, ne",helper:"resizable-helper",stop:function(e,t){r.ctx.clearRect(0,0,r.ctx.canvas.width,r.ctx.canvas.height),r.width=t.size.width,r.height=t.size.height,r.setCanvasSize(),r.ctx.save(),r.ctx.translate(r.ctx.canvas.width/2,r.ctx.canvas.height/2),r.ctx.drawImage(r.image_,-r.width/2,-r.height/2,r.width,r.height),r.ctx.restore()}}),jQuery(e).rotatable({stop:function(e,t){}});var i=document.createElement("canvas");return i.id="canvas",e.appendChild(i),this.div_=e,this.canvas=i,this.ctx=i.getContext("2d"),this.initImage(),this.getPanes().overlayImage.appendChild(this.div_),this},CanvasOverlay.prototype.draw=function(){this.div_;null==this.canvas&&alert("error creating the canvas")},CanvasOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_)},CanvasOverlay.prototype.hide=function(){this.div_&&(this.div_.style.visibility="hidden")},CanvasOverlay.prototype.show=function(){this.div_&&(this.div_.style.visibility="visible")},CanvasOverlay.prototype.toggle=function(){this.div_&&("hidden"==this.div_.style.visibility?this.show():this.hide())},CanvasOverlay.prototype.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(this.map_)},CanvasOverlay.prototype.getCanvas=function(){return this.canvas},CanvasOverlay.prototype.getContext2d=function(){return this.ctx},CanvasOverlay.prototype.setCanvasSize=function(){this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.div_.style.width=this.width+"px",this.div_.style.height=this.height+"px"},CanvasOverlay.prototype.initImage=function(){this.setCanvasSize(),this.ctx.save(),this.ctx.translate(this.ctx.canvas.width/2,this.ctx.canvas.height/2),this.ctx.rotate(this.angle),this.ctx.drawImage(this.image_,-this.width/2,-this.height/2,this.width,this.height),this.ctx.restore()},CanvasOverlay.prototype.drawBoundingCanvas=function(){var e=getRotationDegrees($("#canvas_editor")),t=deg2rad(e);console.log("deg["+e+"] rad["+t+"]"),$("#canvas_editor").css({"-moz-transform":"rotate(0deg)","-webkit-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)","-o-transform":"rotate(0deg)",transform:"rotate(0deg)"});var i,o=getPositionData($("#canvas_editor")),n=o.left,r=o.top,a=n+this.width/2,l=r+this.height/2,s=a+(n-a)*Math.cos(t)+(r-l)*Math.sin(t),c=l-(n-a)*Math.sin(t)+(r-l)*Math.cos(t),u=a+(n+this.width-a)*Math.cos(t)+(r-l)*Math.sin(t),p=l-(n+this.width-a)*Math.sin(t)+(r-l)*Math.cos(t),d=a+(n-a)*Math.cos(t)+(r+this.height-l)*Math.sin(t),g=l-(n-a)*Math.sin(t)+(r+this.height-l)*Math.cos(t),f=a+(n+this.width-a)*Math.cos(t)+(r+this.height-l)*Math.sin(t),_=l-(n+this.width-a)*Math.sin(t)+(r+this.height-l)*Math.cos(t),m=Math.max(s,u,d,f),h=Math.max(c,p,g,_),P=Math.min(s,u,d,f),I=Math.min(c,p,g,_),A=I,v=P,S=m-P,L=h-I;console.log("w["+S+"] h["+L+"]"),$("#canvas_editor").css({top:A+"px",left:v+"px"}),this.ctx.canvas.width=S,this.ctx.canvas.height=L,this.ctx.save(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.translate(a-v,l-A),this.ctx.rotate(t),this.ctx.drawImage(this.image_,-this.width/2,-this.height/2,this.width,this.height),this.ctx.restore(),this.top=A,this.left=v,null!=(i=this.getProjection())&&(this.bottom_left_coords=i.fromContainerPixelToLatLng(new google.maps.Point(this.left,this.top+L),!0),this.top_right_coords=i.fromContainerPixelToLatLng(new google.maps.Point(this.left+S,this.top),!0))};var getPositionData=function(e){return $.extend({width:e.outerWidth(!1),height:e.outerHeight(!1)},e.offset())},LPUtils={};function hexToBase64(e){return btoa(String.fromCharCode.apply(null,e.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")))}function base64_encode(e){var t,i,o,n,r,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,s=0,c="",u=[];if(!e)return e;for(;t=(r=e.charCodeAt(l++)<<16|e.charCodeAt(l++)<<8|e.charCodeAt(l++))>>18&63,i=r>>12&63,o=r>>6&63,n=63&r,u[s++]=a.charAt(t)+a.charAt(i)+a.charAt(o)+a.charAt(n),l<e.length;);c=u.join("");var p=e.length%3;return(p?c.slice(0,p-3):c)+"===".slice(p||3)}function USGSOverlay(e,t,i){this.bounds_=e,this.image_=t,this.image64=t,this.map_=i,this.div_=null,this.setMap(i)}LPUtils.isNullOrUndefined=function(e){return null==e},LPUtils.isStringEmptyNullUndefined=function(e){return!e||0===e.length},LPUtils.isStringBlankNullUndefined=function(e){return!e||/^\s*$/.test(e)},LPUtils.alert=function(e){document.getElementById("notification_panel").innerHTML='<alert type="error" close="LPUtils.closeAlert()">'+e+"</alert>"},LPUtils.closeAlert=function(){document.getElementById("notification_panel").getEl.innerHTML=""},LPUtils.success=function(e){document.getElementById("notification_panel").innerHTML='<alert type="success">'+e+"</alert>"},LPUtils.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,i,o,n,r,a,l,s="",c=0;for(e=LPUtils.Base64._utf8_encode(e);c<e.length;)n=(t=e.charCodeAt(c++))>>2,r=(3&t)<<4|(i=e.charCodeAt(c++))>>4,a=(15&i)<<2|(o=e.charCodeAt(c++))>>6,l=63&o,isNaN(i)?a=l=64:isNaN(o)&&(l=64),s=s+this._keyStr.charAt(n)+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(l);return s},decode:function(e){var t,i,o,n,r,a,l="",s=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");s<e.length;)t=this._keyStr.indexOf(e.charAt(s++))<<2|(n=this._keyStr.indexOf(e.charAt(s++)))>>4,i=(15&n)<<4|(r=this._keyStr.indexOf(e.charAt(s++)))>>2,o=(3&r)<<6|(a=this._keyStr.indexOf(e.charAt(s++))),l+=String.fromCharCode(t),64!=r&&(l+=String.fromCharCode(i)),64!=a&&(l+=String.fromCharCode(o));return l=LPUtils.Base64._utf8_decode(l)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var o=e.charCodeAt(i);o<128?t+=String.fromCharCode(o):(127<o&&o<2048?t+=String.fromCharCode(o>>6|192):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128)),t+=String.fromCharCode(63&o|128))}return t},_utf8_decode:function(e){for(var t="",i=0,o=c1=c2=0;i<e.length;)(o=e.charCodeAt(i))<128?(t+=String.fromCharCode(o),i++):191<o&&o<224?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&o)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&o)<<12|(63&c2)<<6|63&c3),i+=3);return t}},LPUtils.Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=e.length/4*3,i=new ArrayBuffer(t);return this.decode(e,i),i},decode:function(e,t){var i,o,n,r,a,l,s,c=this._keyStr.indexOf(e.charAt(e.length-1)),u=this._keyStr.indexOf(e.charAt(e.length-2)),p=e.length/4*3;64==c&&p--,64==u&&p--;var d=0,g=0;for(i=t?new Uint8Array(t):new Uint8Array(p),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),d=0;d<p;d+=3)o=this._keyStr.indexOf(e.charAt(g++))<<2|(a=this._keyStr.indexOf(e.charAt(g++)))>>4,n=(15&a)<<4|(l=this._keyStr.indexOf(e.charAt(g++)))>>2,r=(3&l)<<6|(s=this._keyStr.indexOf(e.charAt(g++))),i[d]=o,64!=l&&(i[d+1]=n),64!=s&&(i[d+2]=r);return i}},USGSOverlay.prototype=new google.maps.OverlayView,USGSOverlay.prototype.onAdd=function(){var e=document.createElement("div");e.id="ground_overlay",e.style.borderStyle="none",e.style.borderWidth="0px",e.style.position="absolute";var t=document.createElement("img");t.src=this.image64,t.style.width="100%",t.style.height="100%",t.style.position="absolute",e.appendChild(t),this.div_=e,this.getPanes().overlayLayer.appendChild(e)},USGSOverlay.prototype.draw=function(){var e=this.getProjection(),t=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),i=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),o=this.div_;o.style.left=t.x+"px",o.style.top=i.y+"px",o.style.width=i.x-t.x+"px",o.style.height=t.y-i.y+"px"},USGSOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},app.controller("AlertController",["$rootScope","$scope","AnyplaceService",function(e,t,i){t.anyService=i,t.alerts=i.alerts,t.closeable=!0}]),app.controller("BuildingController",["$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService",function(u,e,p,t,i){u.gmapService=p,u.anyService=t,u.anyAPI=i,u.myBuildings=[],u.myBuildingsHashT={},u.fetchVersion=function(){u.anyAPI.version({}).then(function(e){var t=getPrettyVersion(e.data);LOG.D3("Anyplace Version: "+t),document.getElementById("anyplace-version").textContent="v"+t},function(e){console.log("Failed to get version: "+e.data)})},u.fetchVersion();var d=new MarkerClusterer(u.gmapService.gmap);u.$watch("anyService.selectedBuilding",function(e,t){if(e&&e.coordinates_lat&&e.coordinates_lon){if(!e.buid)return void _err(u,"Some information is missing from the building and it could not be loaded.");t&&t.buid&&u.myBuildingsHashT[t.buid].marker.setVisible(!0),u.myBuildingsHashT[e.buid].marker.setVisible(!1),u.gmapService.gmap.panTo(g(e)),u.gmapService.gmap.setZoom(20);try{"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastBuilding",e.buid)}catch(e){}}else!function(e){for(var t in u.myBuildingsHashT)u.myBuildingsHashT.hasOwnProperty(t)&&u.myBuildingsHashT[t].marker.setVisible(e)}(!0)});var g=function(e){if(e&&e.coordinates_lat&&e.coordinates_lon)return{lat:parseFloat(e.coordinates_lat),lng:parseFloat(e.coordinates_lon)}};u.fetchBuilding=function(e){var t={buid:e};u.anyAPI.getOneBuilding(t).then(function(e){var t=e.data.space;u.myBuildings.push(t);var i=getMapsIconBuildingViewer(u,g(t));d.addMarker(i);var o='<div class="infowindow-scroll-fix"><h5>Building:</h5><span>'+t.name+'</span><h5>Description:</h5><textarea class="infowindow-text-area"  rows="3" readonly>'+t.description+"</textarea></div>";i.infoContent=o,i.building=t,u.myBuildingsHashT[t.buid]={marker:i,model:t},google.maps.event.addListener(i,"click",function(){infowindow.setContent(this.infoContent),infowindow.open(p.gmap,this),setTimeout(function(){infowindow.setMap(null)},2e3);var e=this;u.$apply(function(){u.anyService.selectedBuilding=e.building})}),u.anyService.selectedBuilding=t},function(e){_err(u,"No matching building found")})},u.fetchAllBuildings=function(){var e={};e.username=u.creds.username,e.password=u.creds.password,u.anyAPI.allBuildings(e).then(function(e){var t=e.data;u.myBuildings=t.spaces,u.greeklish=t.greeklish;var i=new google.maps.InfoWindow({content:"-",maxWidth:500}),o=-1,n=void 0;try{"undefined"!=typeof Storage&&localStorage&&localStorage.getItem("lastBuilding")&&(n=localStorage.getItem("lastBuilding"))}catch(e){}for(var r=-1,a=0;a<u.myBuildings.length;a++){var l=u.myBuildings[a];n&&n===l.buid&&(o=a),"true"===l.is_published||1==l.is_published?l.is_published=!0:l.is_published=!1,u.urlBuid&&u.urlBuid==l.buid&&(r=a);var s=getMapsIconBuildingViewer(u,g(l));d.addMarker(s);var c='<div class="infowindow-scroll-fix"><h5 style="margin: 0">Building:</h5><span>'+l.name+'</span><h5 style="margin: 8px 0 0 0">Description:</h5><span>'+l.description+"</span></div>";s.infoContent=c,s.building=l,u.myBuildingsHashT[l.buid]={marker:s,model:l},google.maps.event.addListener(s,"click",function(){i.setContent(this.infoContent),i.open(p.gmap,this),setTimeout(function(){i.setMap(null)},2e3);var e=this;u.$apply(function(){u.anyService.selectedBuilding=e.building})})}-1<r?u.anyService.selectedBuilding=u.myBuildings[r]:u.urlBuid?u.fetchBuilding(u.urlBuid):0<=o&&(u.anyService.selectedBuilding=u.myBuildings[o])},function(e){ShowError(u,e,ERR_FETCH_BUILDINGS)})},u.fetchAllBuildings();u.orderByName=function(e){return e.name},u.orderByDistCentre=function(e){if(u.anyService.selectedBuilding)return e.name;var t,i,o,n,r=u.gmapService.gmap.getCenter();return t=parseFloat(e.coordinates_lat),i=parseFloat(e.coordinates_lon),o=r.lat(),n=r.lng(),Math.sqrt(Math.pow(o-t,2)+Math.pow(n-i,2))}}]),app.controller("ControlBarController",["$scope","$rootScope","$routeParams","$location","$compile","GMapService","AnyplaceService",function(o,e,t,i,n,r,a){o.anyService=a,o.gmapService=r,o.isFirefox=-1<navigator.userAgent.search("Firefox"),o.creds={username:void 0,password:void 0},o.user={name:void 0,email:void 0,username:void 0,password:void 0,owner_id:void 0,access_token:void 0},o.tab=1;var l=i.search();l&&(o.urlBuid=l.buid,o.urlFloor=l.floor,o.urlPuid=l.selected,o.greeklish="false"),o.setTab=function(e){o.tab=e},o.isTabSet=function(e){return o.tab===e};var s=$("#my-loc-control");s.replaceWith(n(s.html())(o));var c=void 0;o.userPosition=void 0;var u=-1,p=!1;o.isUserLocVisible=!1,o.getIsUserLocVisible=function(){return o.isUserLocVisible},o.panToUserLocation=function(){o.userPosition&&(r.gmap.panTo(o.userPosition),r.gmap.setZoom(20))},o.isMyLocMarkerShown=function(){return c&&c.getMap()},o.displayMyLocMarker=function(e){if(c&&c.getMap())c.setPosition(e);else{var t=new google.maps.Size(20,20);o.isFirefox&&(t=new google.maps.Size(48,48)),c=new google.maps.Marker({position:e,map:r.gmap,draggable:!1,icon:{url:"build/images/location-radius-centre.png",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,10),size:t,scaledSize:new google.maps.Size(20,20)}})}},o.showUserLocation=function(){if(o.getIsUserLocVisible())return o.hideUserLocation(),void(navigator.geolocation&&navigator.geolocation.clearWatch(u));navigator.geolocation?u=navigator.geolocation.watchPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};o.userPosition=t,o.displayMyLocMarker(t);var i=new google.maps.InfoWindow({content:"Your current location.",maxWidth:500});google.maps.event.addListener(c,"click",function(){var e=this;o.$apply(function(){i.open(r.gmap,e)})}),o.isUserLocVisible||o.$apply(function(){o.isUserLocVisible=!0}),p||(r.gmap.panTo(t),r.gmap.setZoom(19),p=!0)},function(e){o.$apply(function(){LOG.D2("ControlBarController: geolocation"),HandleGeolocationError(o,e.code)})},{enableHighAccuracy:!1,maximumAge:1/0}):_err(o,ERR_GEOLOC_NOT_SUPPORTED)},o.hideUserLocation=function(){c&&c.setMap(null),o.isUserLocVisible=!1},o.showAndroidPrompt=function(){try{if("undefined"!=typeof Storage&&localStorage&&localStorage.getItem("androidPromptShown")){var e=$("#android_top_DIV_1");e&&e.remove()}}catch(e){}},o.hideAndroidBar=function(){var e=$("#android_top_DIV_1");e&&e.remove();try{"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("androidPromptShown",!0)}catch(e){}};var d=navigator.userAgent.toLowerCase(),g=-1<d.indexOf("android")&&-1<!d.indexOf("windows"),f=$("#android_top_DIV_1");f&&g&&f.css({display:"block"}),o.centerViewToSelectedItem=function(){var e={};if(o.anyService.selectedPoi){var t=o.anyService.selectedPoi;e={lat:parseFloat(t.coordinates_lat),lng:parseFloat(t.coordinates_lon)}}else{if(!o.anyService.selectedBuilding)return void _err(o,"No building is selected.");var i=o.anyService.selectedBuilding;e={lat:parseFloat(i.coordinates_lat),lng:parseFloat(i.coordinates_lon)}}o.gmapService.gmap.panTo(e),o.gmapService.gmap.setZoom(20)}}]),app.controller("DropDownCtrl",["$scope",function(t){t.items=[],t.status={isopen:!1},t.toggled=function(e){},t.toggleDropdown=function(e){e.preventDefault(),e.stopPropagation(),t.status.isopen=!t.status.isopen}}]),app.controller("FloorController",["$scope","$compile","AnyplaceService","GMapService","AnyplaceAPIService",function(a,e,i,l,o){a.anyService=i,a.anyAPI=o,a.xFloors=[],a.data={floor_plan_coords:{},floor_plan_base64_data:{},floor_plan_groundOverlay:null};a.$watch("anyService.selectedBuilding",function(e,t){e&&e.buid?a.fetchAllFloorsForBuilding(e):a.removeFloorPlanOverlay()}),a.$watch("anyService.selectedFloor",function(e,t){if(null!=e){a.fetchFloorPlanOverlay(e),l.gmap.panTo(n(a.anyService.selectedBuilding)),l.gmap.setZoom(20);try{"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastFloor",e.floor_number)}catch(e){}}}),a.removeFloorPlanOverlay=function(){a.data.floor_plan_groundOverlay&&a.data.floor_plan_groundOverlay.setMap(null)};var n=function(e){if(e&&e.coordinates_lat&&e.coordinates_lon)return{lat:parseFloat(e.coordinates_lat),lng:parseFloat(e.coordinates_lon)}};a.orderByFloorNo=function(e){return!e||LPUtils.isNullOrUndefined(e.floor_number)?0:parseInt(e.floor_number)},a.fetchAllFloorsForBuilding=function(e){var t=i.jsonReq;t.buid=e.buid,o.allBuildingFloors(t).then(function(e){a.xFloors=e.data.floors,a.xFloors=a.xFloors.sort(function(e,t){return parseInt(e.floor_number)-parseInt(t.floor_number)}),a.anyService.availableFloors={};for(var t=0;t<a.xFloors.length;t++){var i=a.xFloors[t];a.anyService.availableFloors[i.floor_number]=i}if(a.urlFloor)for(var o=0;o<a.xFloors.length;o++)if(a.urlFloor==a.xFloors[o].floor_number)return void(a.anyService.selectedFloor=a.xFloors[o]);try{if("undefined"!=typeof Storage&&localStorage&&!LPUtils.isNullOrUndefined(localStorage.getItem("lastBuilding"))&&!LPUtils.isNullOrUndefined(localStorage.getItem("lastFloor")))for(var n=0;n<a.xFloors.length;n++)if(String(a.xFloors[n].floor_number)===String(localStorage.getItem("lastFloor")))return void(a.anyService.selectedFloor=a.xFloors[n])}catch(e){}for(var r=0;r<a.xFloors.length;r++)if("0"==a.xFloors[r].floor_number)return void(a.anyService.selectedFloor=a.xFloors[r]);a.xFloors[0]&&(a.anyService.selectedFloor=a.xFloors[0])},function(e){ShowError(a,e,"Something went wrong while fetching all floors",!0)})},a.fetchFloorPlanOverlay=function(){var n=a.anyService.selectedFloor.floor_number,r=a.anyService.selectedBuilding.buid;o.downloadFloorPlan(this.anyService.jsonReq,r,n).then(function(e){if(r==a.anyService.selectedBuilding.buid&&n==a.anyService.selectedFloor.floor_number){a.data.floor_plan_file=null,(a.data.floor_plan=null)!=a.data.floor_plan_groundOverlay&&(a.data.floor_plan_groundOverlay.setMap(null),a.data.floor_plan_groundOverlay=null);var t=e.data,i=a.anyService.selectedFloor,o=new google.maps.LatLngBounds(new google.maps.LatLng(i.bottom_left_lat,i.bottom_left_lng),new google.maps.LatLng(i.top_right_lat,i.top_right_lng));a.data.floor_plan_groundOverlay=new USGSOverlay(o,"data:image/png;base64,"+t,l.gmap)}},function(e){})};a.isCanvasOverlayActive=!1,a.setFloorPlan=function(){},a.removeFloorPlan=function(){a.data.floor_plan_file=null,a.data.floor_plan=null;var e=$("#input-floor-plan");e.replaceWith(e=e.clone(!0)),e.prop("disabled",!1),a.isCanvasOverlayActive=!1},a.floorUp=function(){for(var e=0;e<a.xFloors.length;e++)if(a.xFloors[e].floor_number==a.anyService.selectedFloor.floor_number)return e+1<a.xFloors.length?void(a.anyService.selectedFloor=a.xFloors[e+1]):void 0;_err(a,"Floor not found.")},a.floorDown=function(){for(var e=0;e<a.xFloors.length;e++)if(a.xFloors[e].floor_number==a.anyService.selectedFloor.floor_number)return 0<=e-1?void(a.anyService.selectedFloor=a.xFloors[e-1]):void 0;_err(a,"Floor not found.")};var t=$("#floor-controls");t.replaceWith(e(t.html())(a))}]),app.controller("LocationSearchController",["$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService",function(u,e,p,t,o){u.gmapService=p,u.anyService=t,u.anyAPI=o,u.myBuildings=[],u.myBuildingsHashT={},u.mylastquery="",u.myallPois=[];this.querySearch=function(e){return""!=e?(e!=u.mylastquery&&(u.anyService.selectedSearchPoi=e,setTimeout(function(){e==u.anyService.selectedSearchPoi&&u.fetchAllPoiBasedOnLocation(e,u.userPosition)},1e3),u.mylastquery=e),u.myallPois):void 0},u.fetchAllPoiBasedOnLocation=function(t,e){var i={"access-control-allow-origin":"","content-encoding":"gzip","access-control-allow-credentials":"true","content-length":"17516","content-type":"application/json",buid:u.buid,cuid:u.urlCampus,letters:t,greeklish:u.greeklish};null==i.greeklish&&(i.greeklish="true"),o.retrieveALLPois(i).then(function(e){var t=e.data;u.myallPois=t.pois;for(var i=u.myallPois.length-1;0<=i;i--)u.myallPois[i].buname=u.myBuildingsnames[u.myallPois[i].buid]},function(e){""==t&&ShowError(u,e,"Something went wrong while fetching POIs",!0)})};function i(e){for(var t in u.myBuildingsHashT)u.myBuildingsHashT.hasOwnProperty(t)&&u.myBuildingsHashT[t].marker.setVisible(e)}var d=new MarkerClusterer(u.gmapService.gmap);u.$watch("anyService.selectedBuilding",function(e,t){if(e&&e.coordinates_lat&&e.coordinates_lon){if(!e.buid)return void _err(u,"Some information is missing from the building and it could not be loaded.");i(!1),t&&t.buid&&u.myBuildingsHashT[t.buid].marker.setVisible(!0),u.myBuildingsHashT[e.buid].marker.setVisible(!1),u.gmapService.gmap.panTo(g(e)),u.gmapService.gmap.setZoom(20);try{"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastBuilding",e.buid)}catch(e){}}else i(!0)});var g=function(e){if(e&&e.coordinates_lat&&e.coordinates_lon)return{lat:parseFloat(e.coordinates_lat),lng:parseFloat(e.coordinates_lon)}};u.fetchBuilding=function(e){var t={buid:e};u.anyAPI.getOneBuilding(t).then(function(e){var t=e.data.space;u.myBuildings.push(t);var i=getMapsIconBuildingViewer(u,g(t));d.addMarker(i);var o='<div class="infowindow-scroll-fix"><h5>Building:</h5><span>'+t.name+'</span><h5>Description:</h5><textarea class="infowindow-text-area"  rows="3" readonly>'+t.description+"</textarea></div>";i.infoContent=o,i.building=t,u.myBuildingsHashT[t.buid]={marker:i,model:t},google.maps.event.addListener(i,"click",function(){infowindow.setContent(this.infoContent),infowindow.open(p.gmap,this),setTimeout(function(){infowindow.setMap(null)},2e3);var e=this;u.$apply(function(){u.anyService.selectedBuilding=e.building})}),u.anyService.selectedBuilding=t},function(e){_err(u,"No matching building found")})},u.fetchAllBuildings=function(){var e={};e.username=u.creds.username,e.password=u.creds.password,u.anyAPI.allBuildings(e).then(function(e){var t=e.data;u.myBuildings=t.spaces,u.greeklish=t.greeklish;var i=new google.maps.InfoWindow({content:"-",maxWidth:500}),o=-1,n=void 0;try{"undefined"!=typeof Storage&&localStorage&&localStorage.getItem("lastBuilding")&&(n=localStorage.getItem("lastBuilding"))}catch(e){}for(var r=-1,a=0;a<u.myBuildings.length;a++){var l=u.myBuildings[a];n&&n===l.buid&&(o=a),"true"===l.is_published||1==l.is_published?l.is_published=!0:l.is_published=!1,u.urlBuid&&u.urlBuid==l.buid&&(r=a);var s=getMapsIconBuildingViewer(u,g(l));d.addMarker(s);var c='<div class="infowindow-scroll-fix"><h5 style="margin: 0">Building:</h5><span>'+l.name+'</span><h5 style="margin: 8px 0 0 0">Description:</h5><span>'+l.description+"</span></div>";s.infoContent=c,s.building=l,u.myBuildingsHashT[l.buid]={marker:s,model:l},google.maps.event.addListener(s,"click",function(){i.setContent(this.infoContent),i.open(p.gmap,this),setTimeout(function(){i.setMap(null)},2e3);var e=this;u.$apply(function(){u.anyService.selectedBuilding=e.building})})}-1<r?u.anyService.selectedBuilding=u.myBuildings[r]:u.urlBuid?u.fetchBuilding(u.urlBuid):0<=o&&(u.anyService.selectedBuilding=u.myBuildings[o])},function(e){ShowError(u,e,ERR_FETCH_BUILDINGS)})},u.fetchAllBuildings();u.orderByName=function(e){return e.name},u.orderByDistCentre=function(e){if(u.anyService.selectedBuilding)return e.name;var t,i,o,n,r=u.gmapService.gmap.getCenter();return t=parseFloat(e.coordinates_lat),i=parseFloat(e.coordinates_lon),o=r.lat(),n=r.lng(),Math.sqrt(Math.pow(o-t,2)+Math.pow(n-i,2))}}]),app.controller("PoiController",["$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService",function(f,_,m,i,o){var n=new google.maps.Size(62,93),r=new google.maps.Size(93,93),a=new google.maps.Size(21,32),l=new google.maps.Size(32,32),s=new google.maps.Size(48,48);f.anyService=i,f.anyAPI=o,f.gmapService=m,f.myPois=[],f.myPoisHashT={},f.myEntrances=[],f.showPoiDescription=!1,f.poiShareUrl={puid:void 0,url:"..."},f.poiRouteState={form:void 0},f.mylastquery="",f.myallPois=[];this.querySearch=function(e){return""!=e?e!=f.mylastquery?(f.anyService.selectedSearchPoi=e,setTimeout(function(){e==f.anyService.selectedSearchPoi&&f.fetchAllPoi(e,f.anyService.selectedBuilding.buid)},1e3),void(f.mylastquery=e)):f.myallPois:f.myPois},f.fetchAllPoi=function(t,e){var i={"access-control-allow-origin":"","content-encoding":"gzip","access-control-allow-credentials":"true","content-length":"17516","content-type":"application/json",buid:e,cuid:"",letters:t,greeklish:f.greeklish};null==i.greeklish&&(i.greeklish="true"),o.retrieveALLPois(i).then(function(e){var t=e.data;f.myallPois=t.pois},function(e){""==t&&ShowError(f,e,"Something went wrong while fetching POIs",!0)})},f.togglePoiDescription=function(){f.showPoiDescription=!f.showPoiDescription};var g=void 0,c={},h=void 0,u=void 0,p=!1,d=void 0;google.maps.event.addListener(f.gmapService.gmap,"zoom_changed",function(){(this.getZoom()<=17?e:t)()});google.maps.event.addListener(f.gmapService.gmap,"click",function(){!function(){if(f.anyService.selectedPoi){var e=f.anyService.selectedPoi;e.puid&&f.myPoisHashT[e.puid]&&f.myPoisHashT[e.puid].marker&&f.myPoisHashT[e.puid].marker.infowindow&&f.myPoisHashT[e.puid].marker.infowindow.setMap(null)}}()}),f.$watch("anyService.selectedBuilding",function(e,t){e&&e.buid?(p=!1,f.removePoisOnMap(),f.myEntrances=[],f.myPoisHashT={},f.fetchAllPoisForBuilding(e)):(f.anyService.selectedPoi=void 0,f.removePoisOnMap()),f.clearNavPolylines()}),f.$watch("anyService.selectedFloor",function(e,t){null!=e&&p?(e.floor_number&&f.showPoisOnlyForFloor(e.floor_number),y(e,t)):f.anyService.selectedPoi=void 0}),f.$watch("anyService.selectedPoi",function(e,t){if(e&&e.puid&&P(e)){if(f.poiShareUrl.puid=void 0,f.poiShareUrl.url="...",f.anyService.getFloorNumber()!=e.floor_number&&f.anyService.setSelectedFloorByNum(e.floor_number),m.gmap.panTo(P(e)),m.gmap.setZoom(20),e.puid&&f.myPoisHashT[e.puid]&&f.myPoisHashT[e.puid].marker){var i=f.myPoisHashT[e.puid].marker;i.setVisible(!0),i.setIcon(S(e)),i.infowindow&&(i.infowindow.setContent(i.tpl2),i.infowindow.open(m.gmap,i))}d&&d.puid&&f.myPoisHashT[d.puid]&&f.myPoisHashT[d.puid].marker&&(f.myPoisHashT[d.puid].marker.setIcon(L(d)),m.gmap.getZoom()<=17&&f.myPoisHashT[d.puid].marker.setVisible(!1));try{"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastPoi",e.puid)}catch(e){}d=e}});var P=function(e){if(e&&e.coordinates_lat&&e.coordinates_lon)return{lat:parseFloat(e.coordinates_lat),lng:parseFloat(e.coordinates_lon)}};f.orderByName=function(e){return e.name},f.orderByFloor=function(e){return parseInt(e.floor_number)+e.name};function I(e){var t=l;return f.isFirefox&&(t=r),(e.is_building_entrance&&e.is_building_entrance||"Stair"===e.pois_type||"Elevator"===e.pois_type)&&(t=a,f.isFirefox&&(t=n)),t}function A(e){var t="build/images/poi.png";return e.is_building_entrance&&"false"!==e.is_building_entrance?t="build/images/poi_icon_entrance-green.png":"Stair"===e.pois_type?t="build/images/poi_icon_stairs-orange.png":"Elevator"===e.pois_type&&(t="build/images/poi_icon_elevator-purple.png"),t}function v(){for(var e in c)c.hasOwnProperty(e)&&c[e].polyline&&c[e].polyline.setMap(null);c={}}var S=function(e){var t=s;return f.isFirefox&&(t=n),{url:"build/images/poi-new.png",size:t,scaledSize:s}},L=function(e){return{url:A(e),size:I(e),scaledSize:I(e)}},y=function(e,t){if(c){if(e&&e.floor_number){var i=e.floor_number;c[i]&&c[i].polyline&&c[i].polyline.setMap(f.gmapService.gmap)}if(t&&t.floor_number){var o=t.floor_number;c[o]&&c[o].polyline&&c[o].polyline.setMap(null)}}};f.unselectBuilding=function(){f.anyService.selectedBuilding=void 0;try{"undefined"!=typeof Storage&&localStorage&&localStorage.removeItem("lastBuilding"),localStorage.removeItem("lastFloor"),localStorage.removeItem("lastPoi")}catch(e){}},f.clearNavPolylines=function(){v(),h&&h.setMap(null),m.isRouteShown()&&m.clearRoute(),u&&u.setMap(null),f.getIsUserLocVisible()||f.hideUserLocation()},f.navRoutesShown=function(){for(var e in c)if(c.hasOwnProperty(e)&&c[e].polyline&&c[e].polyline.getMap())return!0;return!(!h||!h.getMap())||!!m.isRouteShown()},f.zoomInPoi=function(){f.gmapService.gmap.panTo(P(f.anyService.selectedPoi)),f.gmapService.gmap.setZoom(20)},f.fetchAllPoisForBuilding=function(e){var t=i.jsonReq;t.buid=e.buid,o.retrievePoisByBuilding(t).then(function(e){var t=e.data;f.myPois=t.pois;for(var i=f.myPois.length-1;0<=i;i--){var o=f.myPois[i].puid;"true"===f.myPois[i].is_building_entrance?(f.myPois[i].is_building_entrance=!0,f.myEntrances.push(f.myPois[i])):f.myPois[i].is_building_entrance=!1,f.myPoisHashT[o]={},f.myPoisHashT[o].model=f.myPois[i]}p=!0,f.drawPoisOnMapForBuilding(),f.showPoisOnlyForFloor(f.anyService.getFloorNumber())},function(e){ShowError(f,e,"Something went wrong while fetching POIs",!0)})},f.retrieveRouteFromPoiToPoi=function(r,e){if(r&&r.puid)if(e&&e.puid){var t=f.creds;t.pois_from=r.puid,t.pois_to=e.puid,o.retrieveRouteFromPoiToPoi(t).then(function(e){var t=e.data.pois;v();for(var i=0;i<t.length;i++)if(t[i].lat&&t[i].lon&&t[i].floor_number){var o=t[i].floor_number;c.hasOwnProperty(o)||(c[o]={flightPlanCoordinates:[]}),c[o].flightPlanCoordinates.push(new google.maps.LatLng(parseFloat(t[i].lat),parseFloat(t[i].lon)))}for(var n in c)c.hasOwnProperty(n)&&(c[n].polyline=new google.maps.Polyline({path:c[n].flightPlanCoordinates,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.75,strokeWeight:6}),f.anyService.selectedFloor.floor_number===n&&c[n].polyline.setMap(f.gmapService.gmap));if(g){(u=new google.maps.Polyline({path:[new google.maps.LatLng(parseFloat(r.coordinates_lat),parseFloat(r.coordinates_lon)),new google.maps.LatLng(f.userPosition.lat,f.userPosition.lng)],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:0,strokeWeight:6,icons:[{icon:{path:"M 0,-1 0,1",strokeOpacity:.75,scale:4},offset:"0",repeat:"20px"}]})).setMap(f.gmapService.gmap),g=void 0}},function(e){ShowError(f,e,"Something went wrong while fetching route.",!0)})}else _err(f,"Source POI is corrupted.");else _err(f,"Source POI is corrupted.")};function O(e,t,i,o){return Math.sqrt((i-e)*(i-e)+(o-t)*(o-t))}f.getPoiShareUrl=function(e){if(e!==f.poiShareUrl.puid){f.poiShareUrl.puid=e,f.anyService.selectedPoi&&f.anyService.selectedPoi.puid==e||(f.anyService.selectedPoi=f.myPoisHashT[e].model);var t="https://anyplace.cs.ucy.ac.cy/viewer/?"+f.anyService.getViewerUrl();f.poiShareUrl.embed='<iframe width="100%" height="500" frameborder="0" scrolling="yes" marginheight="0" marginwidth="0" src="'+t+'"></iframe>';var i={longUrl:t};f.anyAPI.googleUrlShortener(i).then(function(e){f.poiShareUrl.url=e.data.id},function(e){f.poiShareUrl.url=t})}else f.poiShareUrl.puid=void 0},f.startNavFromPoi=function(){f.poiRouteState.from=f.anyService.selectedPoi,_suc(f,"Now you can click on another POI to draw the indoor path between the 2 points.")},f.getHtml5GeoLocation=function(e,t){navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t):_err(f,"Geolocation is not supported by this browser.")},f.navigateFromUserToPoiAux=function(e){if(e){var t=e.lat,i=e.lng;f.userPosition||(f.userPosition={lat:t,lng:i});var o=new google.maps.LatLng(t,i),n=f.anyService.selectedPoi;if(n){if(M(t,i)){var r,a=Number.MAX_VALUE,l=void 0,s=f.myPoisHashT;for(var c in s)if(s.hasOwnProperty(c)){var u=s[c].model;if(!u||u.floor_number!=n.floor_number)continue;(r=O(parseFloat(u.coordinates_lat),parseFloat(u.coordinates_lon),t,i))<=a&&(a=r,l=u)}return g=l,f.retrieveRouteFromPoiToPoi(l,n),void(f.getIsUserLocVisible()||f.displayMyLocMarker({lat:t,lng:i}))}g=void 0;var p=new google.maps.LatLng(parseFloat(n.coordinates_lat),parseFloat(n.coordinates_lon)),d=function(e){var t=parseFloat(e.coordinates_lat),i=parseFloat(e.coordinates_lon),o=f.myEntrances;o&&o.length||(o=f.myPois);for(var n=Number.MAX_VALUE,r=void 0,a=0;a<o.length;a++){if(o[a].puid==e.puid)return e;var l,s=parseFloat(o[a].coordinates_lat),c=parseFloat(o[a].coordinates_lon);o&&0<o.length&&(l=O(t,i,s,c)),l<n&&(n=l,r=o[a])}return r}(n);d&&(p=new google.maps.LatLng(parseFloat(d.coordinates_lat),parseFloat(d.coordinates_lon))),f.gmapService.calcRoute(o,p,function(e){if(e){var t=f.anyService.selectedPoi;if(d){var i=d,o=[e,new google.maps.LatLng(parseFloat(i.coordinates_lat),parseFloat(i.coordinates_lon))];h&&h.setMap(null);(h=new google.maps.Polyline({path:o,geodesic:!0,strokeColor:"#73B9FF",strokeOpacity:0,strokeWeight:6,icons:[{icon:{path:"M 0,-1 0,1",strokeOpacity:.75,scale:4},offset:"0",repeat:"20px"}]})).setMap(f.gmapService.gmap),i.puid!=t.puid&&f.retrieveRouteFromPoiToPoi(i,t)}}})}else _err(f,"No target poi found.")}else _err(f,"Invalid position detected by HTML5.")},f.navigateFromUserToPoi=function(e){f.anyService.selectedPoi&&f.anyService.selectedPoi.puid==e||(f.anyService.selectedPoi=f.myPoisHashT[e].model),f.getIsUserLocVisible()&&f.userPosition?f.navigateFromUserToPoiAux(f.userPosition):f.getHtml5GeoLocation(function(e){var t=e.coords.latitude,i=e.coords.longitude;f.navigateFromUserToPoiAux({lat:t,lng:i})},function(e){f.$apply(function(){LOG.E("PoiController: getHtml5GeoLocation"),HandleGeolocationError(f,e.code)})})},f.drawPoisOnMapForBuilding=function(){var e=new google.maps.InfoWindow({content:"-",maxWidth:500}),t=void 0,i=-1;try{"undefined"==typeof Storage||!localStorage||LPUtils.isNullOrUndefined(localStorage.getItem("lastBuilding"))||LPUtils.isNullOrUndefined(localStorage.getItem("lastFloor"))||LPUtils.isNullOrUndefined(localStorage.getItem("lastPoi"))||(t=localStorage.getItem("lastPoi"))}catch(e){}for(var o=!1,n=void 0,r=-1,a=0;a<f.myPois.length;a++){var l,s=f.myPois[a];t&&s.puid===t&&(i=a),f.urlPuid&&f.urlPuid==s.puid&&(r=a);var c;if("None"!=s.pois_type){var u=A(s),p=I(s);f.isFirefox&&(p=new google.maps.Size(62,93));var d=I(s);l=new google.maps.Marker({position:P(s),map:m.gmap,draggable:!1,icon:{url:u,size:p,scaledSize:d},visible:!1}),c='<div class="iw infowindow-scroll-fix"><div class="wordwrap" style="text-align: center"><span ng-show="navRoutesShown()" id="info-window-zoomin" ng-click="zoomInPoi()"><img src="build/images/html5_location_icon.png"></span><span class="iw-poi-name">'+s.name+'</span></div><div class="wordwrap iw-poi-description" ng-show="showPoiDescription">'+s.description+'</div><div style="text-align: center"><div class="poi-action-btn"><button class="btn btn-info" ng-click="togglePoiDescription()"><i class="fa fa-info-circle"></i></i></button></div><div class="poi-action-btn"><button class="btn btn-primary" ng-click="startNavFromPoi()"><i style="font-size: 12px;" class="fa fa-flag"></i></button></div><div class="poi-action-btn"><button class="btn btn-success" ng-click="navigateFromUserToPoi(\''+s.puid+'\')"><i class="fa fa-location-arrow"></i></button></div><div class="poi-action-btn"><button class="btn btn-warning" ng-click="getPoiShareUrl(\''+s.puid+'\')"><i class="fa fa-share-alt"></i></button></div></div><div ng-show="poiShareUrl.puid" style="margin-top: 2px"><div>Share URL:</div><input class="form-control" value="{{poiShareUrl.url}}" onClick="selectAllInputText(this)" readonly/><div>Embed:</div><input class="form-control" value="{{poiShareUrl.embed}}" onClick="selectAllInputText(this)" readonly/></div></div>';var g=_(c)(f);l.tpl2=g[0],l.model=s,l.infowindow=e,f.myPoisHashT[s.puid].marker=l,google.maps.event.addListener(l,"click",function(){var t=this;f.$apply(function(){if(t.model&&t.model.puid){if(f.poiRouteState.from){var e=f.poiRouteState.from;return f.retrieveRouteFromPoiToPoi(e,t.model),e&&e.puid&&f.myPoisHashT[e.puid]&&f.myPoisHashT[e.puid].marker&&(t.infowindow.setContent(f.myPoisHashT[e.puid].marker.tpl2),t.infowindow.open(m.gmap,f.myPoisHashT[e.puid].marker)),void(f.poiRouteState.from=void 0)}f.poiRouteState.from=void 0,f.anyService.selectedPoi&&f.anyService.selectedPoi.puid!=t.model.puid&&f.navRoutesShown()&&f.clearNavPolylines(),f.anyService.selectedPoi&&f.anyService.selectedPoi.puid==t.model.puid&&(t.infowindow.setContent(t.tpl2),t.infowindow.open(m.gmap,t)),f.anyService.selectedPoi=t.model}})}),o&&s.is_building_entrance&&(n=s,o=!0)}}0<=r?f.anyService.selectedPoi=f.myPois[r]:0<=i?f.anyService.selectedPoi=f.myPois[i]:o&&n&&(f.anyService.selectedPoi=n)},f.showPoisOnlyForFloor=function(e){for(var t=0;t<f.myPois.length;t++){var i=f.myPois[t];if(i&&f.myPoisHashT[i.puid]&&f.myPoisHashT[i.puid].marker){var o=f.myPoisHashT[i.puid].marker;i.floor_number!=e?(o.setVisible(!1),o.infowindow&&o.infowindow.getMap()&&o.infowindow.setMap(null)):o.setVisible(!0)}}},f.removePoisOnMap=function(){for(var e=0;e<f.myPois.length;e++){var t=f.myPois[e];t&&f.myPoisHashT[t.puid]&&f.myPoisHashT[t.puid].marker&&(f.myPoisHashT[t.puid].marker.setMap(null),delete f.myPoisHashT[t.puid])}};var e=function(){for(var e=0;e<f.myPois.length;e++){var t=f.myPois[e];if(!f.anyService.selectedPoi||t.puid!=f.anyService.selectedPoi.puid)if(t&&f.myPoisHashT[t.puid]&&f.myPoisHashT[t.puid].marker)f.myPoisHashT[t.puid].marker.setVisible(!1)}},t=function(){for(var e=0;e<f.myPois.length;e++){var t=f.myPois[e];if(t.floor_number==f.anyService.getFloorNumber())if(t&&f.myPoisHashT[t.puid]&&f.myPoisHashT[t.puid].marker)f.myPoisHashT[t.puid].marker.setVisible(!0)}},M=function(e,t){var i=f.anyService.selectedFloor;if(!i)return!1;var o=parseFloat(i.bottom_left_lat),n=parseFloat(i.bottom_left_lng),r=parseFloat(i.top_right_lat),a=parseFloat(i.top_right_lng),l=O(o,n,r,a)/2;return O((o+r)/2,(n+a)/2,e,t)<=l}}]);